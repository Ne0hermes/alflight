<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpÃ©cification Technique ComplÃ¨te - ALFlight</title>
    <style>
        @page {
            size: A4;
            margin: 2cm;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #fff;
        }

        h1 {
            color: #93163C;
            border-bottom: 3px solid #93163C;
            padding-bottom: 10px;
            margin-top: 40px;
            font-size: 32px;
        }

        h2 {
            color: #93163C;
            border-bottom: 2px solid #ddd;
            padding-bottom: 8px;
            margin-top: 30px;
            font-size: 26px;
        }

        h3 {
            color: #333;
            margin-top: 25px;
            font-size: 20px;
            border-left: 4px solid #93163C;
            padding-left: 15px;
        }

        h4 {
            color: #555;
            margin-top: 20px;
            font-size: 16px;
            font-weight: 600;
        }

        .toc {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 8px;
            margin: 30px 0;
            border: 1px solid #ddd;
        }

        .toc h2 {
            margin-top: 0;
            border-bottom: none;
        }

        .toc ul {
            list-style: none;
            padding-left: 0;
        }

        .toc ul ul {
            padding-left: 30px;
        }

        .toc li {
            margin: 10px 0;
        }

        .toc a {
            text-decoration: none;
            color: #93163C;
            font-weight: 500;
        }

        .toc a:hover {
            text-decoration: underline;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 14px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        th {
            background: #93163C;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }

        td {
            padding: 10px 12px;
            border: 1px solid #ddd;
        }

        tr:nth-child(even) {
            background: #f8f9fa;
        }

        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #d63384;
        }

        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #93163C;
            overflow-x: auto;
            font-size: 13px;
            line-height: 1.4;
        }

        pre code {
            background: none;
            padding: 0;
            color: #333;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #0366d6;
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .success-box {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .error-box {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin: 0 5px 5px 0;
        }

        .badge-primary {
            background: #93163C;
            color: white;
        }

        .badge-success {
            background: #28a745;
            color: white;
        }

        .badge-warning {
            background: #ffc107;
            color: #333;
        }

        .badge-info {
            background: #17a2b8;
            color: white;
        }

        ul, ol {
            margin: 15px 0;
            padding-left: 30px;
        }

        li {
            margin: 8px 0;
        }

        .file-tree {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.8;
            border: 1px solid #ddd;
        }

        .highlight {
            background: #ffeb3b;
            padding: 2px 4px;
            font-weight: 600;
        }

        strong {
            color: #93163C;
        }

        .page-break {
            page-break-after: always;
        }

        @media print {
            body {
                font-size: 11pt;
            }

            h1 {
                page-break-before: always;
                page-break-after: avoid;
            }

            h2, h3 {
                page-break-after: avoid;
            }

            table {
                page-break-inside: avoid;
            }

            .info-box, .warning-box, .success-box, .error-box {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>

<!-- PAGE DE GARDE -->
<div style="text-align: center; padding: 100px 0;">
    <h1 style="font-size: 48px; border: none; color: #93163C;">ALFLIGHT</h1>
    <h2 style="font-size: 32px; border: none; color: #555; margin-top: 20px;">SpÃ©cification Technique ComplÃ¨te</h2>
    <p style="font-size: 18px; color: #777; margin-top: 40px;">Documentation exhaustive du systÃ¨me de prÃ©paration de vol</p>
    <p style="font-size: 14px; color: #999; margin-top: 60px;">Version 3.0.0 (Architecture Zustand)</p>
    <p style="font-size: 14px; color: #999;">Date: <span id="doc-date"></span></p>
    <script>document.getElementById('doc-date').textContent = new Date().toLocaleDateString('fr-FR');</script>
</div>

<div class="page-break"></div>

<!-- TABLE DES MATIÃˆRES -->
<div class="toc">
    <h2>Table des matiÃ¨res</h2>
    <ul>
        <li><a href="#intro">1. Introduction GÃ©nÃ©rale</a>
            <ul>
                <li><a href="#intro-objectif">1.1 Objectif Global</a></li>
                <li><a href="#intro-vision">1.2 Vision et FinalitÃ©</a></li>
                <li><a href="#intro-archi">1.3 Architecture GÃ©nÃ©rale</a></li>
            </ul>
        </li>
        <li><a href="#modules">2. Description DÃ©taillÃ©e des Modules</a>
            <ul>
                <li><a href="#modules-core">2.1 Modules de Planification de Vol</a></li>
                <li><a href="#modules-support">2.2 Modules de Support</a></li>
                <li><a href="#modules-admin">2.3 Modules Administratifs</a></li>
            </ul>
        </li>
        <li><a href="#assistants">3. Les Deux Assistants IntÃ©grÃ©s</a>
            <ul>
                <li><a href="#assistant-aircraft">3.1 Assistant de CrÃ©ation d'Avion</a></li>
                <li><a href="#assistant-flight">3.2 Assistant de PrÃ©paration de Vol</a></li>
                <li><a href="#assistant-interaction">3.3 Interactions Entre Assistants</a></li>
            </ul>
        </li>
        <li><a href="#database">4. Base de DonnÃ©es Supabase</a>
            <ul>
                <li><a href="#db-structure">4.1 Structure ComplÃ¨te</a></li>
                <li><a href="#db-tables">4.2 Tables et Relations</a></li>
                <li><a href="#db-triggers">4.3 Triggers et Fonctions</a></li>
                <li><a href="#db-storage">4.4 Storage Buckets</a></li>
            </ul>
        </li>
        <li><a href="#services">5. Couche de Services (32 Services)</a>
            <ul>
                <li><a href="#services-aixm">5.1 Services AIXM/SIA</a></li>
                <li><a href="#services-vac">5.2 Services VAC</a></li>
                <li><a href="#services-perf">5.3 Services Performance</a></li>
                <li><a href="#services-integration">5.4 Services d'IntÃ©gration</a></li>
            </ul>
        </li>
        <li><a href="#architecture">6. Architecture du Projet</a>
            <ul>
                <li><a href="#archi-files">6.1 Inventaire Complet des Fichiers</a></li>
                <li><a href="#archi-structure">6.2 Structure des RÃ©pertoires</a></li>
                <li><a href="#archi-tech">6.3 Stack Technologique</a></li>
            </ul>
        </li>
        <li><a href="#dataflow">7. Flux de Communication</a>
            <ul>
                <li><a href="#flow-state">7.1 Gestion d'Ã‰tat (Zustand)</a></li>
                <li><a href="#flow-contexts">7.2 Contextes React</a></li>
                <li><a href="#flow-inter">7.3 Interconnexions Modules</a></li>
            </ul>
        </li>
        <li><a href="#automation">8. CapacitÃ©s d'Automatisation</a>
            <ul>
                <li><a href="#auto-ai">8.1 Intelligence Artificielle</a></li>
                <li><a href="#auto-calc">8.2 Calculs Automatiques</a></li>
                <li><a href="#auto-sync">8.3 Synchronisation Cloud</a></li>
            </ul>
        </li>
        <li><a href="#technical">9. Aspects Techniques et Performance</a>
            <ul>
                <li><a href="#tech-stack">9.1 Technologies UtilisÃ©es</a></li>
                <li><a href="#tech-perf">9.2 Optimisations Performance</a></li>
                <li><a href="#tech-security">9.3 SÃ©curitÃ©</a></li>
            </ul>
        </li>
        <li><a href="#annexes">10. Annexes</a>
            <ul>
                <li><a href="#annex-glossary">10.1 Glossaire</a></li>
                <li><a href="#annex-dependencies">10.2 DÃ©pendances</a></li>
                <li><a href="#annex-config">10.3 Configuration</a></li>
            </ul>
        </li>
    </ul>
</div>

<div class="page-break"></div>

<!-- SECTION 1: INTRODUCTION GÃ‰NÃ‰RALE -->
<h1 id="intro">1. Introduction GÃ©nÃ©rale</h1>

<h2 id="intro-objectif">1.1 Objectif Global de ALFlight</h2>

<p><strong>ALFlight</strong> est une application web progressive (PWA) de prÃ©paration de vol complÃ¨te, conÃ§ue spÃ©cifiquement pour l'aviation lÃ©gÃ¨re et la navigation VFR/IFR en France. L'application vise Ã  centraliser toutes les Ã©tapes de prÃ©paration de vol dans un environnement unique, moderne et hautement automatisÃ©.</p>

<div class="success-box">
    <strong>ğŸ¯ Mission Principale:</strong> Fournir aux pilotes privÃ©s et professionnels un outil complet de planification de vol qui intÃ¨gre donnÃ©es aÃ©ronautiques officielles (AIXM, SIA France), calculs de performances avancÃ©s, gestion du carburant, masse et centrage, mÃ©tÃ©o en temps rÃ©el, et gÃ©nÃ©ration automatique de plans de vol rÃ©glementaires.
</div>

<h3>Objectifs SpÃ©cifiques</h3>

<ul>
    <li><strong>Centralisation des donnÃ©es:</strong> Regrouper toutes les informations aÃ©ronautiques (aÃ©rodromes, espaces aÃ©riens, points VFR, cartes VAC, NOTAM, mÃ©tÃ©o) dans une interface unique</li>
    <li><strong>Automatisation des calculs:</strong> Calculs automatiques de distance, temps, carburant, performances, masse et centrage, Top of Descent (TOD)</li>
    <li><strong>Intelligence artificielle:</strong> Extraction automatique des tableaux de performances depuis les manuels de vol (MANEX) via OpenAI Vision</li>
    <li><strong>ConformitÃ© rÃ©glementaire:</strong> Respect des minimas rÃ©glementaires pour rÃ©serves de carburant, masse et centrage, limitations opÃ©rationnelles</li>
    <li><strong>Hors-ligne first:</strong> Fonctionnement complet sans connexion Internet grÃ¢ce au stockage local (IndexedDB) des donnÃ©es AIXM (42MB), cartes VAC, et configurations avion</li>
    <li><strong>Partage communautaire:</strong> Base de donnÃ©es partagÃ©e de configurations avion complÃ¨tes (masse, centrage, performances) avec systÃ¨me de votes</li>
</ul>

<h2 id="intro-vision">1.2 Vision et FinalitÃ© du Projet</h2>

<h3>Vision Ã  Long Terme</h3>

<p>ALFlight aspire Ã  devenir <strong>la rÃ©fÃ©rence francophone</strong> pour la prÃ©paration de vol en aviation lÃ©gÃ¨re, en offrant:</p>

<ol>
    <li><strong>GratuitÃ© pour les fonctions essentielles:</strong> Navigation, carburant, mÃ©tÃ©o, VAC accessibles gratuitement</li>
    <li><strong>ModÃ¨le freemium:</strong> Fonctions avancÃ©es (extraction MANEX IA, performances avancÃ©es, partage communautaire) en abonnement Pro</li>
    <li><strong>IntÃ©gration mobile native:</strong> Applications iOS et Android via Capacitor pour utilisation en cockpit</li>
    <li><strong>Extension internationale:</strong> Support des donnÃ©es AIXM europÃ©ennes (EUROCONTROL), puis mondiales</li>
    <li><strong>Ã‰cosystÃ¨me ouvert:</strong> API publique pour intÃ©gration avec autres outils (EFB, cartes Ã©lectroniques, systÃ¨mes embarquÃ©s)</li>
</ol>

<h3>FinalitÃ© pour les Utilisateurs</h3>

<div class="info-box">
    <strong>Pour le Pilote PrivÃ©:</strong>
    <ul>
        <li>PrÃ©parer un vol complet en 15-20 minutes (vs 45-60 minutes manuellement)</li>
        <li>Avoir confiance dans les calculs de performances et de masse grÃ¢ce aux donnÃ©es issues des manuels officiels</li>
        <li>Respecter automatiquement les minimas rÃ©glementaires</li>
        <li>GÃ©nÃ©rer un dossier de vol PDF imprimable et archivable</li>
    </ul>
</div>

<div class="info-box">
    <strong>Pour l'Ã‰cole de Pilotage:</strong>
    <ul>
        <li>Outil pÃ©dagogique pour enseigner la prÃ©paration de vol</li>
        <li>Base de donnÃ©es centralisÃ©e des avions de la flotte</li>
        <li>Suivi des vols et statistiques par Ã©lÃ¨ve</li>
        <li>ConformitÃ© avec les procÃ©dures internes</li>
    </ul>
</div>

<h2 id="intro-archi">1.3 Architecture GÃ©nÃ©rale (Vue d'Ensemble)</h2>

<h3>Architecture en 4 Couches</h3>

<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   COUCHE PRÃ‰SENTATION                         â”‚
â”‚                                                                â”‚
â”‚  â€¢ React 18.2 (UI Components)                                 â”‚
â”‚  â€¢ Material-UI 7.3 (Design System)                            â”‚
â”‚  â€¢ Leaflet 1.9.4 (Cartes interactives)                        â”‚
â”‚  â€¢ Recharts 3.1.2 (Graphiques)                                â”‚
â”‚  â€¢ 18 Feature Modules                                         â”‚
â”‚  â€¢ 2 Assistants (Avion, Vol)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   COUCHE LOGIQUE MÃ‰TIER                       â”‚
â”‚                                                                â”‚
â”‚  â€¢ 32 Services (AIXM, VAC, Performance, Weather, etc.)       â”‚
â”‚  â€¢ Hooks mÃ©tier (useNavigationResults, useAlternates, etc.)  â”‚
â”‚  â€¢ Calculs (interpolation, navigation, masse et centrage)    â”‚
â”‚  â€¢ Validations (conformitÃ© rÃ©glementaire)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   COUCHE GESTION D'Ã‰TAT                       â”‚
â”‚                                                                â”‚
â”‚  â€¢ Zustand (15 stores globaux)                               â”‚
â”‚  â€¢ React Contexts (couche d'accÃ¨s)                           â”‚
â”‚  â€¢ localStorage (donnÃ©es simples)                            â”‚
â”‚  â€¢ IndexedDB (fichiers volumineux: MANEX, AIXM, VAC)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   COUCHE DONNÃ‰ES                              â”‚
â”‚                                                                â”‚
â”‚  â€¢ Supabase PostgreSQL (avions, plans de vol, communautÃ©)   â”‚
â”‚  â€¢ Supabase Storage (MANEX PDFs, VAC PDFs, photos)          â”‚
â”‚  â€¢ AIXM XML Local (42MB donnÃ©es aÃ©ronautiques France)        â”‚
â”‚  â€¢ APIs Externes (OpenAI, AVWX Weather, OpenAIP)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>

<h3>Choix Architecturaux ClÃ©s</h3>

<table>
    <thead>
        <tr>
            <th>Aspect</th>
            <th>Choix Technologique</th>
            <th>Justification</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Framework UI</td>
            <td>React 18.2</td>
            <td>Ã‰cosystÃ¨me mature, performances, composants rÃ©utilisables</td>
        </tr>
        <tr>
            <td>Build Tool</td>
            <td>Vite 7.0.6</td>
            <td>Build ultra-rapide (10x plus rapide que Webpack), HMR instantanÃ©</td>
        </tr>
        <tr>
            <td>State Management</td>
            <td>Zustand 4.5.7</td>
            <td>Simple, performant, pas de boilerplate, immer intÃ©grÃ©</td>
        </tr>
        <tr>
            <td>Backend</td>
            <td>Supabase (PostgreSQL + Storage)</td>
            <td>Backend-as-a-Service, authentification intÃ©grÃ©e, temps rÃ©el, coÃ»t minimal</td>
        </tr>
        <tr>
            <td>Mobile</td>
            <td>Capacitor 7.4.3</td>
            <td>Code partagÃ© web/mobile, accÃ¨s natif (GPS, filesystem, etc.)</td>
        </tr>
        <tr>
            <td>Cartes</td>
            <td>Leaflet 1.9.4</td>
            <td>LÃ©ger, extensible, compatible mobile</td>
        </tr>
        <tr>
            <td>PDF</td>
            <td>pdf-lib + pdfjs-dist</td>
            <td>GÃ©nÃ©ration et lecture PDF cÃ´tÃ© client</td>
        </tr>
        <tr>
            <td>IA</td>
            <td>OpenAI GPT-4o Vision</td>
            <td>Extraction donnÃ©es depuis images de tableaux de performances</td>
        </tr>
    </tbody>
</table>

<h3>Front-End vs Back-End</h3>

<div class="warning-box">
    <strong>âš ï¸ Architecture Front-End Heavy:</strong> ALFlight est principalement une application front-end. Le back-end (Supabase) sert uniquement de stockage cloud optionnel. <strong>Toute la logique mÃ©tier</strong> (calculs, interpolations, validations) est cÃ´tÃ© client pour permettre le fonctionnement hors-ligne.
</div>

<ul>
    <li><strong>Front-End (Client):</strong> 99% de la logique
        <ul>
            <li>Parsing AIXM XML (42MB)</li>
            <li>Calculs de navigation (distance, cap, temps)</li>
            <li>Interpolation des performances (2D/3D)</li>
            <li>Calculs de masse et centrage</li>
            <li>GÃ©nÃ©ration PDF</li>
            <li>Gestion d'Ã©tat complÃ¨te</li>
        </ul>
    </li>
    <li><strong>Back-End (Supabase):</strong> 1% stockage optionnel
        <ul>
            <li>Sauvegarde plans de vol (optionnel)</li>
            <li>Partage configurations avion (communautÃ©)</li>
            <li>Authentification utilisateur</li>
            <li>Synchronisation multi-appareils</li>
        </ul>
    </li>
</ul>

<div class="page-break"></div>

<!-- SECTION 2: MODULES DÃ‰TAILLÃ‰S -->
<h1 id="modules">2. Description DÃ©taillÃ©e des Modules</h1>

<p>ALFlight est organisÃ© en <strong>18 modules fonctionnels</strong> autonomes, chacun responsable d'un aspect spÃ©cifique de la prÃ©paration de vol.</p>

<h2 id="modules-core">2.1 Modules de Planification de Vol (Core)</h2>

<h3 id="module-aircraft">2.1.1 Module Aircraft (Gestion des Avions)</h3>

<div class="info-box">
    <strong>ğŸ“‚ Emplacement:</strong> <code>src/features/aircraft/</code><br>
    <strong>ğŸ¯ Fonction:</strong> Base de donnÃ©es complÃ¨te des avions avec masse, centrage, performances, vitesses, Ã©quipements<br>
    <strong>ğŸ“¦ Store:</strong> <code>aircraftStore</code> (Zustand) + Supabase sync<br>
    <strong>ğŸ’¾ Persistance:</strong> IndexedDB (avions locaux) + Supabase (communautÃ©)
</div>

<h4>Composants Principaux</h4>

<table>
    <thead>
        <tr>
            <th>Composant</th>
            <th>Fichier</th>
            <th>RÃ´le</th>
            <th>Lignes</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Module Principal</td>
            <td><code>AircraftModule.jsx</code></td>
            <td>Interface liste avions + sÃ©lection</td>
            <td>~800</td>
        </tr>
        <tr>
            <td>Wizard CrÃ©ation</td>
            <td><code>AircraftCreationWizard.jsx</code></td>
            <td>Assistant 7 Ã©tapes (dÃ©taillÃ© section 3.1)</td>
            <td>1420</td>
        </tr>
        <tr>
            <td>Import MANEX</td>
            <td><code>ManexImporter.jsx</code></td>
            <td>Upload manuel de vol (PDF)</td>
            <td>~350</td>
        </tr>
        <tr>
            <td>Analyseur Perf</td>
            <td><code>AdvancedPerformanceAnalyzer.jsx</code></td>
            <td>IA extraction tableaux performances</td>
            <td>~600</td>
        </tr>
        <tr>
            <td>ABAC Builder</td>
            <td><code>AbacBuilderWrapper.jsx</code></td>
            <td>Digitalisation abaques interactifs</td>
            <td>~500</td>
        </tr>
    </tbody>
</table>

<h4>Structure de DonnÃ©es Avion</h4>

<pre><code>{
  // Identification
  id: UUID,
  registration: "F-HSTR",
  model: "DA40 NG",
  manufacturer: "Diamond Aircraft",
  aircraftType: "Avion monomoteur",

  // Vitesses caractÃ©ristiques (kt)
  speeds: {
    vso: 43,  // DÃ©crochage config atterrissage
    vs1: 48,  // DÃ©crochage lisse
    vne: 154, // Ne jamais dÃ©passer
    vno: 127, // Normale max
    vfe: 111, // Volets max
    vy: 76,   // Meilleur taux montÃ©e
    vx: 60,   // Meilleur angle montÃ©e
    // ... 10+ vitesses
  },

  // Masses (kg storage, convertible gal/lbs/ltr)
  weights: {
    emptyWeight: 795,
    mtow: 1150,
    maxPayload: 355,
    // ...
  },

  // Bras de levier (m depuis datum)
  arms: {
    empty: 2.15,
    frontSeats: 2.40,
    rearSeats: 2.85,
    fuelMain: 2.60,
    // ...
  },

  // Enveloppe de centrage
  cgLimits: {
    forward: 2.10,
    aft: 2.50
  },
  cgEnvelope: {
    forwardPoints: [{weight, cg}, ...],
    aftPoints: [{weight, cg}, ...]
  },

  // Performances (tables + modÃ¨les IA)
  performanceTables: [
    {
      type: "takeoff",
      conditions: {altitude, temperature, mass},
      data: [[...], [...]] // Matrice interpolable
    }
  ],
  performanceModels: { /* ModÃ¨les OpenAI extraits */ },

  // Ã‰quipements (codes OACI)
  equipmentCom: {vhf1: true, vhf2: true, ...},
  equipmentNav: {vor: true, dme: true, gnss: true, ...},
  equipmentSurv: {transponderMode: 'C', adsb: false, ...},

  // MANEX PDF
  manex: {
    fileName: "DA40_AFM.pdf",
    fileSize: "25 MB",
    pdfData: "base64..." // ou remoteUrl Supabase
  }
}
</code></pre>

<h4>FonctionnalitÃ©s ClÃ©s</h4>

<ul>
    <li><strong>CrÃ©ation guidÃ©e:</strong> Wizard 7 Ã©tapes avec validation Ã  chaque Ã©tape</li>
    <li><strong>Import MANEX:</strong> Upload PDF manuel de vol jusqu'Ã  50MB</li>
    <li><strong>Extraction IA:</strong> GPT-4o Vision extrait automatiquement tableaux de performances depuis images</li>
    <li><strong>ABAC Curves:</strong> SystÃ¨me TypeScript complet pour digitaliser abaques (courbes de performances)</li>
    <li><strong>Partage communautaire:</strong> Upload configuration avion sur Supabase avec votes up/down</li>
    <li><strong>Variants:</strong> CrÃ©er variantes d'avion existant (ex: F-GBCD basÃ© sur F-HSTR avec masse diffÃ©rente)</li>
    <li><strong>Synchronisation:</strong> Sync bidirectionnelle IndexedDB â†” Supabase</li>
</ul>

<h4>Variables Principales</h4>

<table>
    <thead>
        <tr>
            <th>Variable</th>
            <th>Type</th>
            <th>Source</th>
            <th>Usage</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><code>selectedAircraft</code></td>
            <td>Object</td>
            <td>aircraftStore</td>
            <td>Avion actif pour calculs</td>
        </tr>
        <tr>
            <td><code>aircraftList</code></td>
            <td>Array</td>
            <td>aircraftStore</td>
            <td>Liste complÃ¨te avions</td>
        </tr>
        <tr>
            <td><code>isInitialized</code></td>
            <td>Boolean</td>
            <td>aircraftStore</td>
            <td>Supabase chargÃ©</td>
        </tr>
        <tr>
            <td><code>performanceTables</code></td>
            <td>Array</td>
            <td>aircraft.performanceTables</td>
            <td>Interpolation perf</td>
        </tr>
    </tbody>
</table>

<h4>Interfaces avec Autres Modules</h4>

<ul>
    <li><strong>â†’ Performance Module:</strong> Fournit <code>performanceTables</code> pour interpolation</li>
    <li><strong>â†’ Weight-Balance Module:</strong> Fournit <code>arms</code>, <code>cgLimits</code>, <code>cgEnvelope</code></li>
    <li><strong>â†’ Fuel Module:</strong> Fournit <code>fuelConsumption</code>, <code>fuelCapacity</code></li>
    <li><strong>â†’ Navigation Module:</strong> Fournit <code>cruiseSpeed</code>, <code>climbRate</code></li>
    <li><strong>â†’ Flight Wizard:</strong> SÃ©lection avion Ã©tape 1</li>
</ul>

<div class="page-break"></div>

<h3 id="module-navigation">2.1.2 Module Navigation (Planification de Route)</h3>

<div class="info-box">
    <strong>ğŸ“‚ Emplacement:</strong> <code>src/features/navigation/</code><br>
    <strong>ğŸ¯ Fonction:</strong> Planification route avec waypoints, calcul distance/temps/carburant, analyse espaces aÃ©riens<br>
    <strong>ğŸ“¦ Store:</strong> <code>navigationStore</code><br>
    <strong>ğŸ—ºï¸ Carte:</strong> Leaflet avec couches OpenStreetMap + Espaces aÃ©riens
</div>

<h4>Composants Majeurs (20+)</h4>

<table>
    <thead>
        <tr>
            <th>Composant</th>
            <th>RÃ´le</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><code>NavigationModule.jsx</code></td>
            <td>Interface principale: tableau navigation + carte</td>
        </tr>
        <tr>
            <td><code>AirportSelectorSIA.jsx</code></td>
            <td>Recherche aÃ©rodrome (493 aÃ©rodromes France AIXM)</td>
        </tr>
        <tr>
            <td><code>ReportingPointsSelector.jsx</code></td>
            <td>Points VFR depuis cartes VAC</td>
        </tr>
        <tr>
            <td><code>WaypointCardWithRunways.jsx</code></td>
            <td>Carte waypoint avec pistes, frÃ©quences, Ã©lÃ©vation</td>
        </tr>
        <tr>
            <td><code>RunwayAnalyzer.jsx</code></td>
            <td>Analyse pistes: vent, surface, longueur</td>
        </tr>
        <tr>
            <td><code>AirspaceAnalyzer.jsx</code></td>
            <td>DÃ©tection conflits espaces aÃ©riens</td>
        </tr>
        <tr>
            <td><code>WindAnalysis.jsx</code></td>
            <td>Composantes vent (travers, effectif)</td>
        </tr>
        <tr>
            <td><code>TopOfDescent.jsx</code></td>
            <td>Calcul TOD/TOC</td>
        </tr>
    </tbody>
</table>

<h4>Hook Principal: useNavigationResults</h4>

<pre><code>// Hook qui calcule AUTOMATIQUEMENT tous les rÃ©sultats de navigation
const navigationResults = useNavigationResults();

// Retourne:
{
  totalDistance: 347.2,    // NM
  totalTime: 210,          // minutes
  fuelRequired: 105.3,     // liters (unitÃ©s storage)
  legs: [
    {
      from: "LFST",
      to: "LFMP",
      distance: 167.8,     // NM
      bearing: 245,        // degrÃ©s
      time: 101,           // minutes
      fuelRequired: 50.5   // liters
    },
    // ... autres segments
  ],
  airspaceConflicts: [...] // Espaces traversÃ©s
}
</code></pre>

<h4>DonnÃ©es de Navigation</h4>

<pre><code>// navigationStore
{
  waypoints: [
    {
      type: "departure",
      icao: "LFST",
      name: "STRASBOURG ENTZHEIM",
      lat: 48.5444,
      lon: 7.6283,
      elevation: 490 // ft
    },
    {
      type: "vfr",
      name: "STS (Strasbourg)",
      lat: 48.5742,
      lon: 7.7658,
      elevation: 0
    },
    {
      type: "arrival",
      icao: "LFMP",
      name: "PERPIGNAN RIVESALTES",
      lat: 42.7405,
      lon: 2.8721,
      elevation: 144
    }
  ],
  segmentAltitudes: {
    "LFST-STS": { startAlt: 2500, cruiseAlt: 3500 },
    "STS-LFMP": { startAlt: 3500, cruiseAlt: 4500 }
  },
  flightType: "VFR",
  dayNight: "day"
}
</code></pre>

<h4>Calculs Automatiques</h4>

<table>
    <thead>
        <tr>
            <th>Calcul</th>
            <th>Formule</th>
            <th>UnitÃ©s</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Distance</td>
            <td>Haversine (lat1, lon1, lat2, lon2)</td>
            <td>NM</td>
        </tr>
        <tr>
            <td>Cap</td>
            <td>atan2(Î”lon, Î”lat) avec correction magnÃ©tique</td>
            <td>degrÃ©s</td>
        </tr>
        <tr>
            <td>Temps</td>
            <td>distance / groundSpeed</td>
            <td>minutes</td>
        </tr>
        <tr>
            <td>Carburant</td>
            <td>(time / 60) Ã— fuelConsumption</td>
            <td>liters</td>
        </tr>
        <tr>
            <td>TOD</td>
            <td>(altToDescent / descentRate) Ã— groundSpeed</td>
            <td>NM avant destination</td>
        </tr>
    </tbody>
</table>

<h4>Sources de DonnÃ©es AÃ©ronautiques</h4>

<ul>
    <li><strong>AIXM 4.5 XML (42MB):</strong> Fichier <code>AIXM4.5_all_FR_OM_2025-11-27.xml</code> contenant:
        <ul>
            <li>493 aÃ©rodromes France mÃ©tropolitaine</li>
            <li>Runways (QFU, dimensions, TORA/TODA/ASDA/LDA)</li>
            <li>FrÃ©quences (TWR, APP, GND, ATIS)</li>
            <li>Points VFR (Designated Points)</li>
            <li>Navaids (VOR, NDB, DME)</li>
        </ul>
    </li>
    <li><strong>OpenAIP Airspaces:</strong> GÃ©omÃ©tries espaces aÃ©riens (CTR, TMA, zones rÃ©glementÃ©es)</li>
    <li><strong>VAC Charts:</strong> Points VFR reporting points extraits des cartes VAC</li>
</ul>

<h4>Interfaces avec Autres Modules</h4>

<ul>
    <li><strong>â†’ Fuel Module:</strong> <code>navigationResults.fuelRequired</code> alimente automatiquement le carburant voyage</li>
    <li><strong>â†’ Alternates Module:</strong> Route utilisÃ©e pour calculer zone de recherche dÃ©routements</li>
    <li><strong>â†’ Weather Module:</strong> ICAOs waypoints â†’ auto-fetch METARs</li>
    <li><strong>â†’ VAC Module:</strong> ICAOs â†’ tÃ©lÃ©chargement VAC correspondantes</li>
    <li><strong>â†’ Performance Module:</strong> Altitudes segments pour calculs performances</li>
</ul>

<div class="success-box">
    <strong>âœ¨ Point Fort:</strong> Le hook <code>useNavigationResults()</code> recalcule automatiquement distance, temps et carburant Ã  chaque modification de la route. Les modules dÃ©pendants (Fuel, Alternates) reÃ§oivent instantanÃ©ment les mises Ã  jour grÃ¢ce aux Contexts React.
</div>

<h3 id="module-alternates">2.1.3 Module Alternates (Gestion des DÃ©routements)</h3>

<div class="info-box">
    <strong>ğŸ“‚ Emplacement:</strong> <code>src/features/alternates/</code><br>
    <strong>ğŸ¯ Fonction:</strong> Recherche et sÃ©lection d'aÃ©rodromes de dÃ©routement avec calcul de distance, mÃ©tÃ©o, et scoring automatique<br>
    <strong>ğŸ“¦ Store:</strong> <code>alternatesStore</code> (Zustand)<br>
    <strong>ğŸ’¾ Persistance:</strong> localStorage (alternates sÃ©lectionnÃ©s)
</div>

<h4>Composants Principaux</h4>

<table>
    <thead>
        <tr>
            <th>Composant</th>
            <th>Fichier</th>
            <th>RÃ´le</th>
            <th>Lignes</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Module Principal</td>
            <td><code>AlternatesModule.jsx</code></td>
            <td>Interface sÃ©lection dÃ©routements + carte</td>
            <td>~600</td>
        </tr>
        <tr>
            <td>SÃ©lecteur UnifiÃ©</td>
            <td><code>AlternateSelectorUnified.jsx</code></td>
            <td>Liste suggestions avec scoring</td>
            <td>~400</td>
        </tr>
        <tr>
            <td>Carte Alternates</td>
            <td><code>AlternatesMapView.jsx</code></td>
            <td>Visualisation gÃ©ographique + cercle recherche</td>
            <td>~350</td>
        </tr>
        <tr>
            <td>Hook SÃ©lection</td>
            <td><code>useAdvancedAlternateSelection.js</code></td>
            <td>Algorithme de scoring et tri</td>
            <td>~200</td>
        </tr>
    </tbody>
</table>

<h4>Algorithme de Scoring Alternates</h4>

<p>Le systÃ¨me calcule un <strong>score de pertinence</strong> pour chaque aÃ©rodrome basÃ© sur plusieurs critÃ¨res:</p>

<pre><code>Score Total = (Distance Ã— 0.35) + (Piste Ã— 0.30) + (Ã‰quipements Ã— 0.20) + (MÃ©tÃ©o Ã— 0.15)

DÃ©tails:
- Distance: 1.0 si < 50 NM, dÃ©gressif jusqu'Ã  100 NM
- Piste: Longueur > 1000m = 1.0, 800-1000m = 0.7, < 800m = 0.4
- Ã‰quipements: TWR/APP/GND (+0.3 chacun), ILS (+0.1)
- MÃ©tÃ©o: VMC = 1.0, Marginal = 0.6, IMC = 0.3
</code></pre>

<h4>Calcul du Rayon de Recherche</h4>

<p>Le rayon de recherche est calculÃ© automatiquement en fonction du carburant disponible aprÃ¨s le vol:</p>

<pre><code>// Carburant restant aprÃ¨s le vol
remainingFuel = totalFuel - (taxi + climb + cruise)

// Endurance restante (heures)
remainingEndurance = remainingFuel / fuelConsumption

// Rayon de recherche (NM)
searchRadius = remainingEndurance Ã— cruiseSpeed Ã— 0.7 // coefficient de sÃ©curitÃ©

Exemple:
- Carburant restant: 40L
- Consommation: 25L/h
- Vitesse croisiÃ¨re: 120 kt
â†’ Endurance: 1.6h
â†’ Rayon: 1.6 Ã— 120 Ã— 0.7 = 134 NM
</code></pre>

<h4>Affichage DÃ©tails AÃ©rodrome</h4>

<p>Chaque aÃ©rodrome sÃ©lectionnÃ© affiche:</p>
<ul>
    <li><strong>CoordonnÃ©es complÃ¨tes:</strong> DÃ©cimales + DMS (DegrÃ©s Minutes Secondes)</li>
    <li><strong>Pistes par direction:</strong> QFU, TORA, TODA, ASDA, LDA pour chaque sens</li>
    <li><strong>Altitude terrain:</strong> Ã‰lÃ©vation officielle</li>
    <li><strong>Distance:</strong> Depuis le dernier waypoint de la route</li>
    <li><strong>Score de pertinence:</strong> Pourcentage calculÃ©</li>
</ul>

<h4>Interfaces avec Autres Modules</h4>

<ul>
    <li><strong>â†’ Fuel Module:</strong> <code>alternateFuelRequired</code> alimente le carburant dÃ©routement</li>
    <li><strong>â†’ Weather Module:</strong> ICAOs alternates â†’ auto-fetch METARs</li>
    <li><strong>â†’ Navigation Module:</strong> Route utilisÃ©e pour calculer position et rayon</li>
    <li><strong>â†’ VAC Module:</strong> ICAOs â†’ tÃ©lÃ©chargement VAC correspondantes</li>
</ul>

<div class="success-box">
    <strong>âœ¨ Point Fort:</strong> Le hook <code>useAdvancedAlternateSelection()</code> recalcule automatiquement les suggestions Ã  chaque modification de la route ou du carburant. Le cercle de recherche est affichÃ© sur la carte avec rayon dynamique.
</div>

<h3 id="module-fuel">2.1.4 Module Fuel (Gestion du Carburant)</h3>

<div class="info-box">
    <strong>ğŸ“‚ Emplacement:</strong> <code>src/features/fuel/</code><br>
    <strong>ğŸ¯ Fonction:</strong> Calcul rÃ©glementaire du carburant avec minimas, rÃ©serves, et synchronisation automatique depuis navigation<br>
    <strong>ğŸ“¦ Store:</strong> <code>fuelStore</code> (Zustand)<br>
    <strong>ğŸ’¾ Persistance:</strong> localStorage (fuel data + FOB)
</div>

<h4>Composants Principaux</h4>

<table>
    <thead>
        <tr>
            <th>Composant</th>
            <th>Fichier</th>
            <th>RÃ´le</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Module Principal</td>
            <td><code>FuelModule.jsx</code></td>
            <td>Tableau carburant avec 7 postes</td>
        </tr>
        <tr>
            <td>Hook Sync</td>
            <td><code>useFuelSync.js</code></td>
            <td>Synchronisation auto depuis navigation</td>
        </tr>
        <tr>
            <td>FuelRow</td>
            <td><code>FuelRow</code> (composant)</td>
            <td>Ligne Ã©ditable avec conversion unitÃ©s</td>
        </tr>
    </tbody>
</table>

<h4>Structure du Carburant (7 Postes)</h4>

<table>
    <thead>
        <tr>
            <th>Poste</th>
            <th>Description</th>
            <th>Calcul</th>
            <th>Ã‰ditable</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><strong>Roulage</strong></td>
            <td>Taxi dÃ©part + taxi arrivÃ©e</td>
            <td>DÃ©faut: 5L (configurable)</td>
            <td>âœ… Oui</td>
        </tr>
        <tr>
            <td><strong>Trip (Voyage)</strong></td>
            <td>Carburant route complÃ¨te</td>
            <td><code>navigationResults.fuelRequired</code></td>
            <td>ğŸ”’ Auto (lecture seule)</td>
        </tr>
        <tr>
            <td><strong>Contingency (ImprÃ©vus)</strong></td>
            <td>5% du trip fuel (rÃ©glementaire)</td>
            <td><code>trip Ã— 0.05</code></td>
            <td>âœ… Oui (min 5%)</td>
        </tr>
        <tr>
            <td><strong>Alternate (DÃ©routement)</strong></td>
            <td>Carburant vers alternate le plus loin</td>
            <td><code>maxDistanceAlternate / GS Ã— flow</code></td>
            <td>ğŸ”’ Auto si alternates sÃ©lectionnÃ©s</td>
        </tr>
        <tr>
            <td><strong>Final Reserve</strong></td>
            <td>30 min en croisiÃ¨re (VFR jour)</td>
            <td><code>(30/60) Ã— fuelConsumption</code></td>
            <td>âœ… Oui (min 30 min)</td>
        </tr>
        <tr>
            <td><strong>Additional (Additionnel)</strong></td>
            <td>Marge dÃ©cision pilote</td>
            <td>DÃ©faut: 0L</td>
            <td>âœ… Oui</td>
        </tr>
        <tr>
            <td><strong>Extra</strong></td>
            <td>Surplus embarquÃ©</td>
            <td>DÃ©faut: 0L</td>
            <td>âœ… Oui</td>
        </tr>
    </tbody>
</table>

<h4>Conversion Automatique des UnitÃ©s</h4>

<p>Le module gÃ¨re 4 unitÃ©s de carburant avec conversion bidirectionnelle:</p>

<pre><code>UnitÃ©s supportÃ©es: L (litres), gal (US gallons), kg, lbs

Conversions:
- 1 gal = 3.78541 L
- 1 L AVGAS = 0.8 kg (densitÃ©)
- 1 lbs = 0.453592 kg

Stockage interne: TOUJOURS en L et gal
Affichage: Selon prÃ©fÃ©rence utilisateur (hook useUnits)
</code></pre>

<h4>Validation RÃ©glementaire FOB</h4>

<p>Le systÃ¨me vÃ©rifie automatiquement que le <strong>Fuel On Board (FOB)</strong> est suffisant:</p>

<pre><code>FOB_required = roulage + trip + contingency + alternate + finalReserve + additional

if (FOB_actual < FOB_required) {
  // âŒ Alerte: Carburant insuffisant
  // EmpÃªche la validation du plan de vol
}

Affichage:
- âœ… Vert si FOB >= required + 10%
- âš ï¸  Orange si FOB >= required
- âŒ Rouge si FOB < required
</code></pre>

<h4>Synchronisation Automatique</h4>

<div class="success-box">
    <strong>âš¡ Auto-Sync:</strong> Le hook <code>useFuelSync()</code> Ã©coute les changements de navigation, alternates, et avion pour recalculer automatiquement:
    <ul>
        <li>Trip fuel depuis <code>navigationResults.fuelRequired</code></li>
        <li>Alternate fuel depuis <code>alternateFuelRequired</code></li>
        <li>Final reserve depuis consommation avion (30 min)</li>
    </ul>
</div>

<h3 id="module-performance">2.1.5 Module Performance (Calculs de Performances)</h3>

<div class="info-box">
    <strong>ğŸ“‚ Emplacement:</strong> <code>src/features/performance/</code><br>
    <strong>ğŸ¯ Fonction:</strong> Calculs dÃ©collage/atterrissage avec interpolation 2D/3D des abaques digitalisÃ©s<br>
    <strong>ğŸ“¦ Hook:</strong> <code>usePerformanceCalculations</code><br>
    <strong>ğŸ’¾ Persistance:</strong> IndexedDB (abaques aircraft)
</div>

<h4>Composants Principaux</h4>

<table>
    <thead>
        <tr>
            <th>Composant</th>
            <th>Fichier</th>
            <th>RÃ´le</th>
            <th>Lignes</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Module Principal</td>
            <td><code>PerformanceModule.jsx</code></td>
            <td>Interface calculs TO/LDG</td>
            <td>~600</td>
        </tr>
        <tr>
            <td>Calculateur Tables</td>
            <td><code>PerformanceTableCalculator.jsx</code></td>
            <td>Interpolation abaques + rÃ©sultats</td>
            <td>~800</td>
        </tr>
        <tr>
            <td>Suggestion Piste</td>
            <td><code>RunwaySuggestionEnhanced.jsx</code></td>
            <td>Analyse QFU optimal selon vent</td>
            <td>~400</td>
        </tr>
        <tr>
            <td>Hook Calculs</td>
            <td><code>usePerformanceCalculations.js</code></td>
            <td>ISA, densitÃ© altitude, corrections</td>
            <td>~300</td>
        </tr>
    </tbody>
</table>

<h4>ParamÃ¨tres d'EntrÃ©e</h4>

<p>Le module collecte automatiquement les donnÃ©es nÃ©cessaires:</p>

<table>
    <thead>
        <tr>
            <th>ParamÃ¨tre</th>
            <th>Source</th>
            <th>Utilisation</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Masse totale</td>
            <td><code>weightBalance.calculations.totalWeight</code></td>
            <td>Interpolation abaques</td>
        </tr>
        <tr>
            <td>QNH</td>
            <td><code>weatherData[icao].metar.qnh</code></td>
            <td>Altitude densitÃ©</td>
        </tr>
        <tr>
            <td>TempÃ©rature</td>
            <td><code>weatherData[icao].metar.temperature</code></td>
            <td>Ã‰cart ISA</td>
        </tr>
        <tr>
            <td>Vent</td>
            <td><code>weatherData[icao].metar.wind</code></td>
            <td>Composante face/arriÃ¨re/travers</td>
        </tr>
        <tr>
            <td>Ã‰lÃ©vation piste</td>
            <td><code>airport.elevation</code></td>
            <td>Altitude densitÃ©</td>
        </tr>
        <tr>
            <td>Abaques</td>
            <td><code>aircraft.performanceTables</code></td>
            <td>Distances, vitesses, pentes</td>
        </tr>
    </tbody>
</table>

<h4>Calcul Altitude DensitÃ©</h4>

<pre><code>// TempÃ©rature ISA standard
ISA_temp = 15Â°C - (2Â°C Ã— (elevation_ft / 1000))

// Ã‰cart ISA
ISA_deviation = actual_temp - ISA_temp

// Altitude pression
pressure_altitude = elevation + ((1013 - QNH) Ã— 30)

// Altitude densitÃ©
density_altitude = pressure_altitude + (120 Ã— ISA_deviation)

Exemple:
- Ã‰lÃ©vation: 1500 ft
- QNH: 1008 hPa
- Temp: 28Â°C
- ISA standard: 15 - (2 Ã— 1.5) = 12Â°C
- Ã‰cart ISA: +16Â°C
- Alt pression: 1500 + ((1013-1008)Ã—30) = 1650 ft
- Alt densitÃ©: 1650 + (120 Ã— 16) = 3570 ft âš ï¸
</code></pre>

<h4>Interpolation Abaques 2D/3D</h4>

<p>Le systÃ¨me supporte 2 types d'abaques:</p>

<div class="info-box">
    <strong>Type 1 - Abaque 2D (simple):</strong><br>
    1 variable d'entrÃ©e â†’ 1 variable de sortie<br>
    Exemple: Masse â†’ Distance dÃ©collage<br>
    <code>Interpolation linÃ©aire: y = y1 + (x - x1) Ã— (y2 - y1) / (x2 - x1)</code>
</div>

<div class="info-box">
    <strong>Type 2 - Abaque 3D (multiple):</strong><br>
    2+ variables â†’ 1 sortie<br>
    Exemple: (Masse, TempÃ©rature) â†’ Distance dÃ©collage<br>
    <code>Interpolation bilinÃ©aire avec grille de valeurs</code>
</div>

<h4>RÃ©sultats Fournis</h4>

<p>Pour chaque phase (TO/LDG), le module calcule:</p>

<table>
    <thead>
        <tr>
            <th>RÃ©sultat</th>
            <th>Description</th>
            <th>UnitÃ©</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><strong>Distance roulement</strong></td>
            <td>Ground roll (sans obstacle)</td>
            <td>m / ft</td>
        </tr>
        <tr>
            <td><strong>Distance 15m</strong></td>
            <td>Distance franchissement 50ft</td>
            <td>m / ft</td>
        </tr>
        <tr>
            <td><strong>V-speeds</strong></td>
            <td>Vr, V2, Vref selon masse</td>
            <td>kt / km/h</td>
        </tr>
        <tr>
            <td><strong>Pente montÃ©e</strong></td>
            <td>Gradient climb au TO</td>
            <td>% ou ft/NM</td>
        </tr>
        <tr>
            <td><strong>Marge piste</strong></td>
            <td>Longueur disponible - requise</td>
            <td>m / ft</td>
        </tr>
    </tbody>
</table>

<h4>Suggestion Piste Optimale</h4>

<p>Le composant <code>RunwaySuggestionEnhanced</code> analyse toutes les pistes et recommande:</p>

<pre><code>Pour chaque QFU:
1. Calculer composante vent face/arriÃ¨re (headwind/tailwind)
2. Calculer composante vent de travers (crosswind)
3. Scorer:
   - Headwind: +1 point par kt
   - Tailwind: -2 points par kt (pÃ©nalitÃ© double)
   - Longueur > required: +10 points
   - Longueur < required: -50 points (Ã©liminatoire)

Affichage:
ğŸŸ¢ Piste recommandÃ©e (meilleur score + marge suffisante)
ğŸŸ¡ Piste acceptable (marge limitÃ©e)
ğŸ”´ Piste inadaptÃ©e (trop courte ou tailwind excessif)
</code></pre>

<h4>Chargement Abaques depuis IndexedDB</h4>

<p>Les abaques sont chargÃ©s Ã  la volÃ©e:</p>

<pre><code>// Au chargement du module
useEffect(() => {
  if (selectedAircraft?.id) {
    // RÃ©cupÃ©rer depuis IndexedDB
    const fullAircraft = await dataBackupManager.getAircraftData(id);

    // Prioriser performanceModels (nouveau format)
    const abaques = fullAircraft.performanceModels || fullAircraft.performanceTables;

    setLoadedPerformanceTables(abaques);
  }
}, [selectedAircraft?.id]);
</code></pre>

<div class="warning-box">
    <strong>âš ï¸ Limitations:</strong>
    <ul>
        <li>Abaques doivent Ãªtre digitalisÃ©s au prÃ©alable (via Aircraft Wizard Step 4)</li>
        <li>Interpolation limitÃ©e aux plages dÃ©finies dans les abaques</li>
        <li>Corrections manuelles nÃ©cessaires pour conditions spÃ©ciales (piste mouillÃ©e, neige, pente)</li>
    </ul>
</div>

<h3 id="module-weight-balance">2.1.6 Module Weight-Balance (Masse et Centrage)</h3>

<div class="info-box">
    <strong>ğŸ“‚ Emplacement:</strong> <code>src/features/weight-balance/</code><br>
    <strong>ğŸ¯ Fonction:</strong> Calcul masse, moments, CG avec 3 scÃ©narios (dÃ©part, arrivÃ©e, atterrissage) et enveloppe graphique<br>
    <strong>ğŸ“¦ Store:</strong> <code>weightBalanceStore</code> (Zustand)<br>
    <strong>ğŸ’¾ Persistance:</strong> localStorage (loads)
</div>

<h4>Composants Principaux</h4>

<table>
    <thead>
        <tr>
            <th>Composant</th>
            <th>Fichier</th>
            <th>RÃ´le</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Module Principal</td>
            <td><code>WeightBalanceModule.jsx</code></td>
            <td>Interface chargement + rÃ©sultats</td>
        </tr>
        <tr>
            <td>LoadInput</td>
            <td><code>LoadInput.jsx</code></td>
            <td>Input poids avec bras de levier</td>
        </tr>
        <tr>
            <td>ScenarioCards</td>
            <td><code>ScenarioCards.jsx</code></td>
            <td>Affichage 3 scÃ©narios</td>
        </tr>
        <tr>
            <td>Chart</td>
            <td><code>WeightBalanceChart.jsx</code></td>
            <td>Graphique enveloppe CG</td>
        </tr>
        <tr>
            <td>Calculations</td>
            <td><code>calculations.js</code></td>
            <td>Calculs CG + scÃ©narios</td>
        </tr>
    </tbody>
</table>

<h4>Postes de Chargement</h4>

<table>
    <thead>
        <tr>
            <th>Poste</th>
            <th>Bras (m)</th>
            <th>Limite</th>
            <th>Notes</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>ğŸ‘¨â€âœˆï¸ SiÃ¨ge avant gauche</td>
            <td>Configurable</td>
            <td>Aucune</td>
            <td>Pilote obligatoire</td>
        </tr>
        <tr>
            <td>ğŸ§‘â€ğŸ¤â€ğŸ§‘ SiÃ¨ge avant droit</td>
            <td>Configurable</td>
            <td>Aucune</td>
            <td>Optionnel</td>
        </tr>
        <tr>
            <td>ğŸ‘¥ SiÃ¨ges arriÃ¨re (Ã—2)</td>
            <td>Configurable</td>
            <td>Selon avion</td>
            <td>Optionnels</td>
        </tr>
        <tr>
            <td>ğŸ’ Bagages (compartiments)</td>
            <td>Variable</td>
            <td>Max par compartiment</td>
            <td>Dynamique selon avion</td>
        </tr>
        <tr>
            <td>â›½ Carburant</td>
            <td>Configurable</td>
            <td>CapacitÃ© rÃ©servoir</td>
            <td>Automatique depuis FOB</td>
        </tr>
    </tbody>
</table>

<h4>Calcul du Centre de GravitÃ©</h4>

<pre><code>// Pour chaque poste i
moment_i = mass_i Ã— arm_i

// Total
total_mass = empty_mass + Î£(loads)
total_moment = empty_moment + Î£(moments)

// Position CG (en mÃ¨tres depuis datum)
CG = total_moment / total_mass

// VÃ©rification limites
forward_limit = aircraft.cgLimits.forward  // ex: 2.00m
aft_limit = aircraft.cgLimits.aft          // ex: 2.45m

if (CG < forward_limit) â†’ âŒ CG trop avant
if (CG > aft_limit) â†’ âŒ CG trop arriÃ¨re
else â†’ âœ… CG dans l'enveloppe
</code></pre>

<h4>Les 3 ScÃ©narios CalculÃ©s</h4>

<div class="info-box">
    <strong>ScÃ©nario 1 - Ramp (Parking):</strong><br>
    Masse totale au roulage = Empty + Occupants + Bagages + FOB<br>
    <code>CG doit Ãªtre dans enveloppe Ã  cette masse</code>
</div>

<div class="info-box">
    <strong>ScÃ©nario 2 - Takeoff (DÃ©collage):</strong><br>
    AprÃ¨s roulage = Ramp - taxi fuel<br>
    <code>CG dÃ©cale lÃ©gÃ¨rement (carburant consommÃ©)</code>
</div>

<div class="info-box">
    <strong>ScÃ©nario 3 - Landing (Atterrissage):</strong><br>
    AprÃ¨s vol = Takeoff - trip fuel - alternate fuel - reserve utilisÃ©e<br>
    <code>CG dÃ©cale significativement vers l'avant (si rÃ©servoir arriÃ¨re)</code>
</div>

<div class="warning-box">
    <strong>âš ï¸ Point Critique:</strong> Un avion peut Ãªtre dans l'enveloppe au dÃ©collage mais <strong>SORTIR de l'enveloppe Ã  l'atterrissage</strong> Ã  cause de la consommation de carburant. Le module vÃ©rifie automatiquement les 3 scÃ©narios.
</div>

<h4>Graphique Enveloppe</h4>

<p>Le composant <code>WeightBalanceChart</code> affiche:</p>
<ul>
    <li><strong>Enveloppe CG:</strong> Polygone vert dÃ©finissant limites forward/aft selon masse</li>
    <li><strong>3 points scÃ©narios:</strong> Ramp (bleu), Takeoff (orange), Landing (vert)</li>
    <li><strong>Ligne de consommation:</strong> Trajectoire du CG pendant le vol</li>
    <li><strong>Limites MTOW:</strong> Ligne horizontale rouge si dÃ©passement</li>
</ul>

<h4>Compartiments Bagages Dynamiques</h4>

<p>Le systÃ¨me supporte des compartiments bagages configurables:</p>

<pre><code>aircraft.baggageCompartments = [
  { id: 'main', name: 'Bagages principaux', maxWeight: 40, arm: 3.50 },
  { id: 'aux', name: 'Bagages auxiliaires', maxWeight: 20, arm: 3.70 },
  { id: 'tube', name: 'Tube bagages', maxWeight: 10, arm: 4.00 }
];

// Les inputs sont gÃ©nÃ©rÃ©s dynamiquement
baggageCompartments.map(comp => (
  <LoadInput
    label={comp.name}
    maxWeight={comp.maxWeight}
    arm={comp.arm}
  />
))
</code></pre>

<h4>Synchronisation Automatique Carburant</h4>

<div class="success-box">
    <strong>âš¡ Auto-Sync:</strong> Le module Ã©coute <code>fobFuel</code> et recalcule automatiquement les 3 scÃ©narios Ã  chaque changement de carburant, de chargement, ou de trajet.
</div>

<h3 id="module-weather">2.1.7 Module Weather (MÃ©tÃ©o AÃ©ronautique)</h3>

<div class="info-box">
    <strong>ğŸ“‚ Emplacement:</strong> <code>src/features/weather/</code><br>
    <strong>ğŸ¯ Fonction:</strong> RÃ©cupÃ©ration METAR/TAF temps rÃ©el via AVWX API avec dÃ©codage automatique et cache intelligent<br>
    <strong>ğŸ“¦ Store:</strong> <code>weatherStore</code> (Zustand)<br>
    <strong>ğŸ’¾ Persistance:</strong> localStorage (weatherData avec timestamps)
</div>

<h4>Composants Principaux</h4>

<table>
    <thead>
        <tr>
            <th>Composant</th>
            <th>Fichier</th>
            <th>RÃ´le</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Module Principal</td>
            <td><code>WeatherModule.jsx</code></td>
            <td>Interface recherche + affichage METAR/TAF</td>
        </tr>
        <tr>
            <td>WeatherCard</td>
            <td><code>WeatherCard.jsx</code></td>
            <td>Affichage dÃ©taillÃ© d'une mÃ©tÃ©o</td>
        </tr>
        <tr>
            <td>Weather Service</td>
            <td><code>weatherService.js</code></td>
            <td>Appels API AVWX + parsing</td>
        </tr>
        <tr>
            <td>Rate Limit Indicator</td>
            <td><code>WeatherRateLimitIndicator.jsx</code></td>
            <td>Affichage quota API restant</td>
        </tr>
    </tbody>
</table>

<h4>API AVWX - ParamÃ¨tres</h4>

<pre><code>Service: https://avwx.rest/api/
Rate Limit: 100 requÃªtes/jour (plan gratuit)
Format rÃ©ponse: JSON avec METAR/TAF dÃ©codÃ©s

Endpoints utilisÃ©s:
- GET /metar/{icao}?options=info,translate
- GET /taf/{icao}?options=info,translate

RÃ©ponse dÃ©codÃ©e inclut:
- QNH (hPa)
- TempÃ©rature (Â°C)
- Point de rosÃ©e (Â°C)
- Vent: direction (Â°), vitesse (kt), rafales (kt)
- VisibilitÃ© (m)
- Plafond (ft)
- PhÃ©nomÃ¨nes mÃ©tÃ©o (RA, SN, FG, etc.)
- Traduction texte franÃ§ais
</code></pre>

<h4>Cache et FraÃ®cheur des DonnÃ©es</h4>

<p>Le systÃ¨me implÃ©mente un cache intelligent pour Ã©conomiser les appels API:</p>

<pre><code>// DurÃ©e validitÃ© METAR
METAR_VALIDITY = 30 minutes

// VÃ©rification fraÃ®cheur
const isStale = (timestamp) => {
  return (Date.now() - timestamp) > (30 * 60 * 1000);
};

// Logique de fetch
if (!weatherData[icao] || isStale(weatherData[icao].timestamp)) {
  // âœ… RÃ©cupÃ©rer depuis API
  await fetchWeather(icao);
} else {
  // âœ… Utiliser cache
  console.log('Using cached weather');
}
</code></pre>

<h4>Chargement Automatique</h4>

<p>Le module charge automatiquement la mÃ©tÃ©o pour:</p>

<ul>
    <li><strong>Waypoints de la route:</strong> Tous les ICAOs dans <code>waypoints[]</code></li>
    <li><strong>Alternates sÃ©lectionnÃ©s:</strong> ICAOs des dÃ©routements</li>
    <li><strong>AÃ©rodromes Performance:</strong> DÃ©part/arrivÃ©e pour calculs TO/LDG</li>
</ul>

<pre><code>// Hook dans WeatherModule
useEffect(() => {
  const waypointIcaos = waypoints
    .map(wp => wp.name)
    .filter(name => name && name.match(/^[A-Z]{4}$/));

  if (waypointIcaos.length > 0) {
    fetchMultiple(waypointIcaos); // Appels parallÃ¨les
  }
}, [waypoints, fetchMultiple]);
</code></pre>

<h4>DÃ©codage METAR/TAF</h4>

<table>
    <thead>
        <tr>
            <th>Ã‰lÃ©ment</th>
            <th>Code METAR</th>
            <th>DÃ©codage</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>QNH</td>
            <td>Q1013</td>
            <td>1013 hPa</td>
        </tr>
        <tr>
            <td>TempÃ©rature</td>
            <td>28/18</td>
            <td>28Â°C / 18Â°C dew point</td>
        </tr>
        <tr>
            <td>Vent</td>
            <td>27015G25KT</td>
            <td>270Â° Ã  15 kt, rafales 25 kt</td>
        </tr>
        <tr>
            <td>VisibilitÃ©</td>
            <td>9999</td>
            <td>> 10 km</td>
        </tr>
        <tr>
            <td>Nuages</td>
            <td>SCT025 BKN040</td>
            <td>Ã‰pars 2500ft, FragmentÃ© 4000ft</td>
        </tr>
        <tr>
            <td>PhÃ©nomÃ¨nes</td>
            <td>-RA BR</td>
            <td>Pluie faible, brume</td>
        </tr>
    </tbody>
</table>

<h4>Suggestions AÃ©rodromes</h4>

<p>Le module inclut un systÃ¨me d'autocomplÃ©tion:</p>

<pre><code>// Recherche dans AIXM local
const airports = await aeroDataProvider.getAirfields({ country: 'FR' });

// Filtrage par ICAO ou nom
const filtered = airports
  .filter(apt =>
    apt.icao.toUpperCase().includes(searchTerm) ||
    apt.name.toUpperCase().includes(searchTerm)
  )
  .slice(0, 10); // Max 10 suggestions

// Affichage dropdown
<Suggestion>
  {apt.icao} - {apt.name} ({apt.type})
</Suggestion>
</code></pre>

<h4>Indicateur Rate Limit</h4>

<p>Le composant <code>WeatherRateLimitIndicator</code> affiche:</p>

<ul>
    <li><strong>RequÃªtes restantes:</strong> 100 - utilisÃ©es aujourd'hui</li>
    <li><strong>Barre de progression:</strong> Visuelle du quota</li>
    <li><strong>Couleur:</strong> Vert (>50), Orange (20-50), Rouge (<20)</li>
    <li><strong>Reset:</strong> Compteur remis Ã  zÃ©ro Ã  minuit UTC</li>
</ul>

<div class="warning-box">
    <strong>âš ï¸ Limitation API:</strong> Le plan gratuit AVWX limite Ã  100 requÃªtes/jour. Le cache intelligent permet de minimiser les appels en rÃ©utilisant les METARs rÃ©cents (<30 min).
</div>

<h3 id="module-vac">2.1.8 Module VAC (Visual Approach Charts)</h3>

<div class="info-box">
    <strong>ğŸ“‚ Emplacement:</strong> <code>src/features/vac/</code><br>
    <strong>ğŸ¯ Fonction:</strong> TÃ©lÃ©chargement automatique des cartes VAC officielles SIA France avec enrichissement points VFR<br>
    <strong>ğŸ“¦ Store:</strong> <code>vacStore</code> (Zustand)<br>
    <strong>ğŸ’¾ Persistance:</strong> IndexedDB (VAC PDFs + mÃ©tadonnÃ©es)
</div>

<h4>Composants Principaux</h4>

<table>
    <thead>
        <tr>
            <th>Composant</th>
            <th>Fichier</th>
            <th>RÃ´le</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Module Principal</td>
            <td><code>VACModule.jsx</code></td>
            <td>Interface liste VAC + viewer</td>
        </tr>
        <tr>
            <td>SIA Report Enhanced</td>
            <td><code>SIAReportEnhanced.jsx</code></td>
            <td>Rapport complet avec VAC enrichies</td>
        </tr>
        <tr>
            <td>VAC Enricher</td>
            <td><code>vacEnricher.js</code></td>
            <td>Ajout points VFR sur cartes</td>
        </tr>
        <tr>
            <td>VAC Service</td>
            <td><code>vacService.js</code></td>
            <td>TÃ©lÃ©chargement SIA + cache</td>
        </tr>
    </tbody>
</table>

<h4>Sources de DonnÃ©es VAC</h4>

<table>
    <thead>
        <tr>
            <th>Source</th>
            <th>Type</th>
            <th>Format</th>
            <th>Utilisation</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>SIA France officiel</td>
            <td>Cartes VAC</td>
            <td>PDF multi-pages</td>
            <td>TÃ©lÃ©chargement automatique</td>
        </tr>
        <tr>
            <td>AIXM 4.5 XML</td>
            <td>Points VFR</td>
            <td>Coordinates + noms</td>
            <td>Enrichissement cartes</td>
        </tr>
        <tr>
            <td>Supabase Storage</td>
            <td>Photos points VFR</td>
            <td>JPEG/PNG</td>
            <td>Affichage communautaire</td>
        </tr>
    </tbody>
</table>

<h4>TÃ©lÃ©chargement Automatique VAC</h4>

<pre><code>// URL SIA France (officiel)
const SIA_BASE_URL = 'https://www.sia.aviation-civile.gouv.fr/';

// Pattern URL VAC
const vacUrl = `${SIA_BASE_URL}/dvd/eAIP_${cycle}/Atlas-VAC/PDF_AIPparSSection/VAC/AD/AD-2.${icao}.pdf`;

// TÃ©lÃ©chargement
const response = await fetch(vacUrl);
const pdfBlob = await response.blob();

// Stockage IndexedDB
await vacStore.saveVAC({
  icao,
  pdfData: await pdfBlob.arrayBuffer(),
  downloadDate: Date.now(),
  cycle: '2025-11-27' // AIRAC
});
</code></pre>

<h4>Enrichissement Points VFR</h4>

<p>Le service <code>vacEnricher</code> ajoute les points VFR sur les cartes:</p>

<pre><code>// 1. Charger PDF VAC
const pdf = await pdfjsLib.getDocument(pdfData).promise;

// 2. Pour chaque page
for (let i = 1; i <= pdf.numPages; i++) {
  const page = await pdf.getPage(i);
  const canvas = document.createElement('canvas');

  // 3. Rendre PDF sur canvas
  await page.render({ canvasContext, viewport }).promise;

  // 4. Trouver points VFR visibles
  const visiblePoints = vfrPoints.filter(pt =>
    isPointInView(pt.coordinates, pageViewport)
  );

  // 5. Dessiner markers
  visiblePoints.forEach(pt => {
    const { x, y } = latLonToPageCoords(pt.coordinates, viewport);

    // Marker rouge
    ctx.fillStyle = '#FF0000';
    ctx.beginPath();
    ctx.arc(x, y, 5, 0, 2 * Math.PI);
    ctx.fill();

    // Label
    ctx.fillText(pt.name, x + 10, y);
  });

  // 6. Convertir en blob enrichi
  const enrichedBlob = await canvas.toBlob();
}
</code></pre>

<h4>Rapport SIA Complet</h4>

<p>Le composant <code>SIAReportEnhanced</code> gÃ©nÃ¨re un rapport multi-aÃ©rodromes:</p>

<ul>
    <li><strong>SÃ©lection aÃ©rodromes:</strong> DÃ©part, arrivÃ©e, alternates</li>
    <li><strong>Pour chaque aÃ©rodrome:</strong>
        <ul>
            <li>Infos gÃ©nÃ©rales (ICAO, nom, Ã©lÃ©vation, coordonnÃ©es)</li>
            <li>Pistes (QFU, dimensions, surfaces)</li>
            <li>FrÃ©quences (TWR, APP, GND, ATIS)</li>
            <li>Points VFR Ã  proximitÃ© (<20 NM)</li>
            <li>Cartes VAC enrichies (toutes les pages)</li>
            <li>METAR/TAF actuels</li>
        </ul>
    </li>
    <li><strong>Export PDF:</strong> GÃ©nÃ©ration dossier complet imprimable</li>
</ul>

<h4>Gestion Cache VAC</h4>

<pre><code>// Stockage IndexedDB
vacStorage = {
  charts: {
    'LFST': {
      icao: 'LFST',
      name: 'Strasbourg Entzheim',
      pdfData: ArrayBuffer,
      downloadDate: 1732089600000,
      cycle: '2025-11-27',
      isEnriched: true,
      enrichedPages: [Blob, Blob, ...],
      vfrPoints: [
        { name: 'STS', lat: 48.5444, lon: 7.6280, photo: 'url' },
        ...
      ]
    }
  }
};

// VÃ©rification validitÃ©
const isValid = (chart) => {
  const age = Date.now() - chart.downloadDate;
  const MAX_AGE = 56 * 24 * 60 * 60 * 1000; // 56 jours (2 cycles AIRAC)
  return age < MAX_AGE;
};
</code></pre>

<h4>Points VFR Communautaires</h4>

<p>Le systÃ¨me supporte l'ajout de photos pour les points VFR:</p>

<pre><code>// Upload photo vers Supabase Storage
const uploadPhoto = async (file, pointId) => {
  const filePath = `vfr-points/${pointId}/${Date.now()}_${file.name}`;

  const { data, error } = await supabase.storage
    .from('vfr-points-photos')
    .upload(filePath, file);

  // RÃ©cupÃ©rer URL publique
  const { data: { publicUrl } } = supabase.storage
    .from('vfr-points-photos')
    .getPublicUrl(filePath);

  // Mettre Ã  jour base de donnÃ©es
  await supabase.from('vfr_points')
    .update({ photo_url: publicUrl })
    .eq('id', pointId);
};
</code></pre>

<div class="success-box">
    <strong>âœ¨ Point Fort:</strong> Les cartes VAC sont automatiquement tÃ©lÃ©chargÃ©es pour tous les aÃ©rodromes de la route et enrichies avec les points VFR officiels + photos communautaires. Le cache intelligent Ã©vite les retÃ©lÃ©chargements.
</div>

<h3 id="module-flight-wizard">2.1.9 Module Flight Wizard (Assistant PrÃ©paration Vol)</h3>

<div class="info-box">
    <strong>ğŸ“‚ Emplacement:</strong> <code>src/features/flight-wizard/</code><br>
    <strong>ğŸ¯ Fonction:</strong> Assistant complet de prÃ©paration de vol en 7 Ã©tapes avec gÃ©nÃ©ration PDF rÃ©glementaire<br>
    <strong>ğŸ“¦ Store:</strong> <code>flightPlanStore</code> + localStorage (draft)<br>
    <strong>ğŸ’¾ Persistance:</strong> localStorage (brouillon) + Supabase (plans validÃ©s)
</div>

<h4>Les 7 Ã‰tapes du Wizard</h4>

<table>
    <thead>
        <tr>
            <th>#</th>
            <th>Titre</th>
            <th>Composant</th>
            <th>DonnÃ©es CollectÃ©es</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>1</td>
            <td>Informations GÃ©nÃ©rales</td>
            <td><code>Step1GeneralInfo.jsx</code></td>
            <td>SÃ©lection avion, callsign, date/heure, type vol</td>
        </tr>
        <tr>
            <td>2</td>
            <td>DÃ©finition Trajet</td>
            <td><code>Step3Route.jsx</code></td>
            <td>Route complÃ¨te, altitudes, TOD, alternates</td>
        </tr>
        <tr>
            <td>3</td>
            <td>AÃ©rodromes & MÃ©tÃ©o</td>
            <td><code>Step3VAC.jsx</code></td>
            <td>VAC enrichies, METAR/TAF, frÃ©quences</td>
        </tr>
        <tr>
            <td>4</td>
            <td>Bilan Carburant</td>
            <td><code>Step5Fuel.jsx</code></td>
            <td>FOB, 7 postes carburant, validation minimas</td>
        </tr>
        <tr>
            <td>5</td>
            <td>Masse et Centrage</td>
            <td><code>Step6WeightBalance.jsx</code></td>
            <td>Chargement, 3 scÃ©narios CG, enveloppe</td>
        </tr>
        <tr>
            <td>6</td>
            <td>Performances</td>
            <td><code>Step5Performance.jsx</code></td>
            <td>TO/LDG distances, pistes recommandÃ©es</td>
        </tr>
        <tr>
            <td>7</td>
            <td>SynthÃ¨se</td>
            <td><code>Step7Summary.jsx</code></td>
            <td>RÃ©capitulatif complet + gÃ©nÃ©ration PDF</td>
        </tr>
    </tbody>
</table>

<h4>ModÃ¨le de DonnÃ©es FlightPlanData</h4>

<pre><code>class FlightPlanData {
  constructor() {
    this.generalInfo = {
      callsign: '',
      flightDate: null,
      departureTime: null,
      flightType: 'VFR',
      dayNight: 'day'
    };

    this.aircraft = null; // RÃ©fÃ©rence avion complet

    this.route = {
      waypoints: [],
      segmentAltitudes: {},
      plannedAltitude: 0,
      todCalculation: {}
    };

    this.alternates = {
      departure: null,
      arrival: null,
      selectedAlternates: []
    };

    this.weather = {
      departure: {},
      arrival: {},
      alternates: {}
    };

    this.fuel = {
      fob: { ltr: 0, gal: 0 },
      breakdown: {
        roulage: {},
        trip: {},
        contingency: {},
        alternate: {},
        finalReserve: {},
        additional: {},
        extra: {}
      },
      confirmed: false
    };

    this.weightBalance = {
      loads: {},
      scenarios: {},
      confirmed: false
    };

    this.performance = {
      takeoff: {},
      landing: {},
      confirmed: false
    };

    this.navigation = {
      results: null,
      legs: []
    };
  }

  // SÃ©rialisation JSON
  toJSON() { ... }
  static fromJSON(json) { ... }
}
</code></pre>

<h4>Persistance Brouillon</h4>

<p>Le wizard sauvegarde automatiquement la progression:</p>

<pre><code>// Sauvegarde automatique aprÃ¨s chaque step
useEffect(() => {
  const draftKey = 'flightPlanDraft';

  // Sauvegarder toutes les 2 secondes (debounced)
  const saveDraft = debounce(() => {
    const draft = {
      flightPlan: flightPlan.toJSON(),
      currentStep: activeStep,
      timestamp: Date.now()
    };

    localStorage.setItem(draftKey, JSON.stringify(draft));
  }, 2000);

  saveDraft();
}, [flightPlan, activeStep]);

// Restauration au chargement
useEffect(() => {
  const draft = localStorage.getItem('flightPlanDraft');

  if (draft) {
    const { flightPlan: savedData, currentStep } = JSON.parse(draft);

    // Restaurer Ã©tat
    setFlightPlan(FlightPlanData.fromJSON(savedData));
    setActiveStep(currentStep);

    // Restaurer contextes
    restoreAircraft(savedData.aircraft);
    restoreRoute(savedData.route);
    restoreFuel(savedData.fuel);
    // ...
  }
}, []);
</code></pre>

<h4>Validation Inter-Ã‰tapes</h4>

<p>Chaque Ã©tape valide les donnÃ©es avant de continuer:</p>

<table>
    <thead>
        <tr>
            <th>Ã‰tape</th>
            <th>Validations</th>
            <th>Blocage</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>1 - GÃ©nÃ©ral</td>
            <td>Avion sÃ©lectionnÃ©, callsign renseignÃ©</td>
            <td>âŒ Si manquants</td>
        </tr>
        <tr>
            <td>2 - Route</td>
            <td>Min 2 waypoints, dÃ©part â‰  arrivÃ©e</td>
            <td>âŒ Si invalide</td>
        </tr>
        <tr>
            <td>3 - VAC</td>
            <td>Aucune (optionnel)</td>
            <td>âœ… Passage libre</td>
        </tr>
        <tr>
            <td>4 - Fuel</td>
            <td>FOB >= required, final reserve >= 30 min</td>
            <td>âš ï¸ Warning mais passage</td>
        </tr>
        <tr>
            <td>5 - W&B</td>
            <td>CG dans enveloppe (3 scÃ©narios), masse < MTOW</td>
            <td>âŒ Si hors limites</td>
        </tr>
        <tr>
            <td>6 - Perf</td>
            <td>Piste suffisante TO/LDG, vent acceptable</td>
            <td>âš ï¸ Warning si critique</td>
        </tr>
        <tr>
            <td>7 - Summary</td>
            <td>Toutes Ã©tapes validÃ©es</td>
            <td>âœ… GÃ©nÃ©ration PDF</td>
        </tr>
    </tbody>
</table>

<h4>GÃ©nÃ©ration PDF Final</h4>

<p>L'Ã©tape 7 gÃ©nÃ¨re un PDF complet avec <code>html2pdf.js</code>:</p>

<pre><code>const generatePDF = async () => {
  // 1. CrÃ©er Ã©lÃ©ment HTML avec toutes les donnÃ©es
  const element = document.createElement('div');
  element.innerHTML = `
    <div style="font-family: Arial; padding: 20px;">
      <!-- En-tÃªte -->
      <h1>Plan de Vol - ${flightPlan.generalInfo.callsign}</h1>
      <p>${new Date(flightPlan.generalInfo.flightDate).toLocaleDateString('fr-FR')}</p>

      <!-- RÃ©capitulatif route -->
      <h2>Trajet</h2>
      <table>
        ${flightPlan.route.waypoints.map(wp => `
          <tr>
            <td>${wp.name}</td>
            <td>${wp.distance} NM</td>
            <td>${wp.time} min</td>
          </tr>
        `).join('')}
      </table>

      <!-- Carburant -->
      <h2>Carburant</h2>
      ...

      <!-- Masse et centrage -->
      <h2>Masse et Centrage</h2>
      ...

      <!-- Performances -->
      <h2>Performances</h2>
      ...

      <!-- VAC + METAR -->
      <h2>Cartes et MÃ©tÃ©o</h2>
      ...
    </div>
  `;

  // 2. GÃ©nÃ©rer PDF
  const pdfBlob = await html2pdf()
    .from(element)
    .set({
      margin: 10,
      filename: `${callsign}_${date}.pdf`,
      html2canvas: { scale: 2 },
      jsPDF: { orientation: 'portrait', unit: 'mm', format: 'a4' }
    })
    .outputPdf('blob');

  // 3. Upload vers Supabase Storage
  await validatedPdfService.uploadValidatedPdf(pdfBlob, {
    callsign,
    flightDate,
    departure: waypoints[0].icao,
    arrival: waypoints[waypoints.length-1].icao
  });

  // 4. Sauvegarder plan de vol dans DB
  await flightPlanSupabaseService.saveFlightPlan(flightPlan.toJSON());

  // 5. Nettoyer brouillon
  localStorage.removeItem('flightPlanDraft');
};
</code></pre>

<div class="success-box">
    <strong>âœ¨ Point Fort:</strong> Le Flight Wizard guide l'utilisateur Ã  travers toutes les Ã©tapes rÃ©glementaires et gÃ©nÃ¨re un dossier de vol complet, conforme, prÃªt Ã  imprimer. La sauvegarde automatique permet de reprendre Ã  tout moment.
</div>

<h2 id="modules-support">2.2 Modules de Support (Gestion et Suivi)</h2>

<h3 id="module-pilot">2.2.1 Module Pilot (Profil Pilote)</h3>

<div class="info-box">
    <strong>ğŸ“‚ Emplacement:</strong> <code>src/features/pilot/</code><br>
    <strong>ğŸ¯ Fonction:</strong> Gestion profil pilote avec licences, qualifications, expÃ©rience, et historique vols<br>
    <strong>ğŸ“¦ Store:</strong> <code>pilotStore</code> (Zustand)<br>
    <strong>ğŸ’¾ Persistance:</strong> Supabase (pilot_profiles)
</div>

<h4>Onglets du Module</h4>

<ul>
    <li><strong>Profil Pilote:</strong> Infos personnelles, licences (PPL/CPL), qualifications (SEP, MEP, IR, etc.)</li>
    <li><strong>Historique des vols:</strong> Tableau complet des vols avec filtres et statistiques</li>
</ul>

<h3 id="module-logbook">2.2.2 Module Logbook (Carnet de Vol)</h3>

<div class="info-box">
    <strong>ğŸ“‚ Emplacement:</strong> <code>src/features/pilot/components/PilotLogbook.jsx</code><br>
    <strong>ğŸ¯ Fonction:</strong> Enregistrement automatique des vols avec extraction depuis plans validÃ©s<br>
    <strong>ğŸ“¦ Store:</strong> <code>logbookStore</code><br>
    <strong>ğŸ’¾ Persistance:</strong> Supabase (logbook_entries)
</div>

<h4>DonnÃ©es EnregistrÃ©es par Vol</h4>

<table>
    <thead>
        <tr>
            <th>Champ</th>
            <th>Source</th>
            <th>Type</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Date</td>
            <td><code>flightPlan.generalInfo.flightDate</code></td>
            <td>Date</td>
        </tr>
        <tr>
            <td>DÃ©part/ArrivÃ©e</td>
            <td><code>route.waypoints[0/last].icao</code></td>
            <td>ICAO</td>
        </tr>
        <tr>
            <td>Avion</td>
            <td><code>aircraft.registration</code></td>
            <td>Text</td>
        </tr>
        <tr>
            <td>Temps de vol</td>
            <td><code>navigationResults.totalTime</code></td>
            <td>Minutes</td>
        </tr>
        <tr>
            <td>Atterrissages</td>
            <td>Comptage waypoints ICAO</td>
            <td>Number</td>
        </tr>
        <tr>
            <td>Jour/Nuit</td>
            <td><code>flightPlan.generalInfo.dayNight</code></td>
            <td>Enum</td>
        </tr>
        <tr>
            <td>Type vol</td>
            <td><code>flightPlan.generalInfo.flightType</code></td>
            <td>VFR/IFR</td>
        </tr>
    </tbody>
</table>

<h4>Statistiques Automatiques</h4>

<ul>
    <li><strong>Temps total:</strong> Somme de tous les vols</li>
    <li><strong>Temps par type avion:</strong> SEP, MEP</li>
    <li><strong>Temps PIC/DUAL:</strong> Commandant de bord vs instruction</li>
    <li><strong>Atterrissages:</strong> Total + jour/nuit sÃ©parÃ©s</li>
    <li><strong>AÃ©rodromes visitÃ©s:</strong> Liste unique ICAOs</li>
</ul>

<h3 id="module-checklist">2.2.3 Module Checklist (Check-lists Avion)</h3>

<div class="info-box">
    <strong>ğŸ“‚ Emplacement:</strong> <code>src/features/checklist/</code><br>
    <strong>ğŸ¯ Fonction:</strong> Check-lists interactives par phase de vol avec progression sauvegardÃ©e<br>
    <strong>ğŸ“¦ Store:</strong> <code>checklistStore</code><br>
    <strong>ğŸ’¾ Persistance:</strong> localStorage (progression)
</div>

<h4>Phases de Vol</h4>

<ul>
    <li>ğŸ“‹ <strong>Before Start:</strong> VÃ©rifications cabine, documents, carburant</li>
    <li>ğŸ”§ <strong>Engine Start:</strong> DÃ©marrage moteur</li>
    <li>ğŸ›« <strong>Before Takeoff:</strong> Checks prÃ©-dÃ©collage</li>
    <li>âœˆï¸ <strong>After Takeoff:</strong> MontÃ©e initiale</li>
    <li>ğŸŒ¤ï¸ <strong>Cruise:</strong> CroisiÃ¨re</li>
    <li>ğŸ›¬ <strong>Before Landing:</strong> Approche et finale</li>
    <li>ğŸ <strong>After Landing:</strong> Vacating runway</li>
    <li>ğŸ”’ <strong>Shutdown:</strong> ArrÃªt moteur et sÃ©curisation</li>
</ul>

<div class="page-break"></div>

<!-- SECTION 3: ASSISTANTS DÃ‰TAILLÃ‰S -->
<h1 id="assistants">3. Les Deux Assistants IntÃ©grÃ©s (Analyse Approfondie)</h1>

<p>ALFlight intÃ¨gre deux assistants majeurs qui guident l'utilisateur Ã  travers des processus complexes. Cette section dÃ©taille <strong>chaque Ã©tape</strong> avec les composants, les donnÃ©es collectÃ©es, les validations, et les flux de donnÃ©es.</p>

<h2 id="assistant-aircraft">3.1 Assistant de CrÃ©ation d'Avion (8 Ã‰tapes)</h2>

<div class="info-box">
    <strong>ğŸ“‚ Fichier principal:</strong> <code>src/features/aircraft/components/AircraftCreationWizard.jsx</code> (1420 lignes)<br>
    <strong>ğŸ¯ Objectif:</strong> CrÃ©er une configuration avion complÃ¨te avec masse, centrage, vitesses, performances, et Ã©quipements<br>
    <strong>ğŸ’¾ Persistance:</strong> Brouillon localStorage + Final IndexedDB + Optionnel Supabase (communautÃ©)
</div>

<h3 id="aircraft-step0">3.1.0 Step 0 - Community Check (VÃ©rification Base Communautaire)</h3>

<div class="info-box">
    <strong>Fichier:</strong> <code>Step0CommunityCheck.jsx</code><br>
    <strong>Objectif:</strong> Rechercher si une configuration avion existe dÃ©jÃ  dans la base communautaire Supabase<br>
    <strong>Actions possibles:</strong> Importer config existante OU CrÃ©er nouvelle configuration
</div>

<h4>Fonctionnement</h4>

<pre><code>// Chargement des presets communautaires
const loadCommunityAircraft = async () => {
  const presets = await communityService.getAllPresets();

  // Transformer au format UI
  const formattedAircraft = presets.map(preset => ({
    id: preset.id,
    registration: preset.registration,
    model: preset.model,
    manufacturer: preset.manufacturer,
    isVerified: preset.verified,
    votes: preset.votes_up - preset.votes_down,
    downloads: preset.downloads_count,
    hasManex: !!preset.manex_file_id,
    uploaded_by: preset.uploaded_by,
    created_at: preset.created_at
  }));

  setCommunityAircraft(formattedAircraft);
};

// Import d'une configuration existante
const handleImportAircraft = async (aircraft) => {
  setIsImporting(true);

  // TÃ©lÃ©charger donnÃ©es complÃ¨tes depuis Supabase
  const fullData = await communityService.getPresetById(aircraft.id);

  // TÃ©lÃ©charger MANEX PDF si disponible
  if (fullData.manex_file_id) {
    const manexBlob = await communityService.downloadManex(fullData.manex_file_id);
    fullData.manex = {
      fileName: manexBlob.name,
      file: await blobToBase64(manexBlob)
    };
  }

  // IncrÃ©menter compteur tÃ©lÃ©chargements
  await communityService.incrementDownloads(aircraft.id);

  // Remplir wizard avec donnÃ©es importÃ©es
  updateDataBulk(fullData.aircraft_data);

  // Passer directement Ã  Step 7 (Review)
  onComplete();
};
</code></pre>

<h4>Interface Utilisateur</h4>

<ul>
    <li><strong>Barre de recherche:</strong> Autocomplete sur registration/model/manufacturer</li>
    <li><strong>Liste rÃ©sultats:</strong> Cards avec:
        <ul>
            <li>Badge "âœ… VÃ©rifiÃ©" si <code>verified = true</code></li>
            <li>Votes communautÃ© (ğŸ‘/ğŸ‘)</li>
            <li>Nombre de tÃ©lÃ©chargements</li>
            <li>IcÃ´ne "ğŸ“– MANEX" si manuel disponible</li>
        </ul>
    </li>
    <li><strong>Actions:</strong>
        <ul>
            <li>Bouton "Importer" â†’ Charge config complÃ¨te</li>
            <li>Bouton "CrÃ©er nouveau" â†’ Skip vers Step 1</li>
        </ul>
    </li>
</ul>

<h3 id="aircraft-step1">3.1.1 Step 1 - Basic Info (Informations GÃ©nÃ©rales)</h3>

<div class="info-box">
    <strong>Fichier:</strong> <code>Step1BasicInfo.jsx</code> (400+ lignes)<br>
    <strong>Objectif:</strong> Saisir identification avion, capacitÃ©s, et upload MANEX PDF<br>
    <strong>DonnÃ©es collectÃ©es:</strong> 12 champs obligatoires + 1 PDF optionnel
</div>

<h4>Champs du Formulaire</h4>

<table>
    <thead>
        <tr>
            <th>Champ</th>
            <th>Type</th>
            <th>Validation</th>
            <th>Exemple</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Registration</td>
            <td>Text</td>
            <td>Required, unique, format F-XXXX</td>
            <td>F-HSTR</td>
        </tr>
        <tr>
            <td>Model</td>
            <td>Text</td>
            <td>Required</td>
            <td>DA40 NG</td>
        </tr>
        <tr>
            <td>Manufacturer</td>
            <td>Text</td>
            <td>Required</td>
            <td>Diamond Aircraft</td>
        </tr>
        <tr>
            <td>Category</td>
            <td>Select</td>
            <td>Enum: SEP/MEP/HÃ©lico/ULM</td>
            <td>SEP</td>
        </tr>
        <tr>
            <td>Engine Type</td>
            <td>Select</td>
            <td>Enum: Piston/Turboprop/Jet</td>
            <td>Piston</td>
        </tr>
        <tr>
            <td>Number of Engines</td>
            <td>Number</td>
            <td>Min: 1, Max: 4</td>
            <td>1</td>
        </tr>
        <tr>
            <td>Number of Seats</td>
            <td>Number</td>
            <td>Min: 1, Max: 19</td>
            <td>4</td>
        </tr>
        <tr>
            <td>Fuel Type</td>
            <td>Select</td>
            <td>Enum: AVGAS100LL/JetA1/Diesel</td>
            <td>AVGAS 100LL</td>
        </tr>
        <tr>
            <td>Fuel Capacity</td>
            <td>Number</td>
            <td>Required, > 0</td>
            <td>114 L</td>
        </tr>
        <tr>
            <td>Usable Fuel</td>
            <td>Number</td>
            <td>Required, < capacity</td>
            <td>110 L</td>
        </tr>
        <tr>
            <td>Fuel Consumption</td>
            <td>Number</td>
            <td>Required, > 0</td>
            <td>24 L/h</td>
        </tr>
        <tr>
            <td>Cruise Speed</td>
            <td>Number</td>
            <td>Required, > 0</td>
            <td>125 kt</td>
        </tr>
    </tbody>
</table>

<h4>Upload MANEX (Manuel de Vol)</h4>

<pre><code>// Gestion upload PDF
const handleManexUpload = async (e) => {
  const file = e.target.files[0];

  // Validation
  if (!file.type === 'application/pdf') {
    alert('Format PDF uniquement');
    return;
  }

  if (file.size > 50 * 1024 * 1024) {
    alert('Fichier trop volumineux (max 50MB)');
    return;
  }

  // Conversion base64 pour localStorage
  const reader = new FileReader();
  reader.onloadend = () => {
    const manexData = {
      fileName: file.name,
      fileSize: `${(file.size / 1024 / 1024).toFixed(2)} MB`,
      uploadDate: new Date().toISOString(),
      file: reader.result // Base64
    };

    updateData('manex', manexData);
  };
  reader.readAsDataURL(file);
};

// Upload vers Supabase Storage (optionnel)
const handleUploadToSupabase = async () => {
  // Convertir base64 â†’ Blob
  const base64 = aircraftData.manex.file.split(',')[1];
  const blob = await fetch(`data:application/pdf;base64,${base64}`).then(r => r.blob());

  // Upload via service
  const { filePath, publicUrl } = await communityService.uploadManex(
    blob,
    aircraftData.registration
  );

  // Stocker rÃ©fÃ©rence
  updateData('manex.remoteUrl', publicUrl);
  updateData('manex.filePath', filePath);
};
</code></pre>

<h3 id="aircraft-step2">3.1.2 Step 2 - Speeds (Vitesses CaractÃ©ristiques)</h3>

<div class="info-box">
    <strong>Fichier:</strong> <code>Step2Speeds.jsx</code> (600+ lignes)<br>
    <strong>Objectif:</strong> Configurer toutes les V-speeds et limitations de vent<br>
    <strong>DonnÃ©es collectÃ©es:</strong> 15+ vitesses + limitations vent dynamiques
</div>

<h4>CatÃ©gories de Vitesses</h4>

<table>
    <thead>
        <tr>
            <th>CatÃ©gorie</th>
            <th>Vitesses</th>
            <th>Obligatoire</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><strong>Flaps Out (Volets sortis)</strong></td>
            <td>Vso, Vs1, Vfe</td>
            <td>âœ… Oui</td>
        </tr>
        <tr>
            <td><strong>Clean Config (Lisse)</strong></td>
            <td>Vs, Vy, Vx, Vr, V2</td>
            <td>âœ… Vs, âš ï¸ autres optionnels</td>
        </tr>
        <tr>
            <td><strong>Vne/Vno (Ne Exceed)</strong></td>
            <td>Vne, Vno</td>
            <td>âœ… Oui</td>
        </tr>
        <tr>
            <td><strong>Vo (Operating Range)</strong></td>
            <td>Plages par masse</td>
            <td>âš ï¸ Optionnel</td>
        </tr>
        <tr>
            <td><strong>Optional Speeds</strong></td>
            <td>Va, Vg, Vmc, etc.</td>
            <td>âŒ Non</td>
        </tr>
    </tbody>
</table>

<h4>Plages Vo Dynamiques (Par Masse)</h4>

<pre><code>// Structure plages Vo
const voRanges = [
  {
    minWeight: 840,  // kg
    maxWeight: 1150, // kg
    speed: 111,      // kt
    saved: true
  },
  // Peut ajouter plusieurs plages
];

// Gestion plages multiples
const addVoRange = () => {
  setVoRanges([...voRanges, {
    minWeight: '',
    maxWeight: '',
    speed: '',
    saved: false
  }]);
};

const saveVoRange = (index) => {
  const range = voTempRanges[index];

  // Validation
  if (!range.minWeight || !range.maxWeight || !range.speed) {
    alert('Tous les champs requis');
    return;
  }

  if (parseFloat(range.minWeight) >= parseFloat(range.maxWeight)) {
    alert('Min doit Ãªtre < Max');
    return;
  }

  // Sauvegarder
  const newRanges = [...voRanges];
  newRanges[index] = { ...range, saved: true };
  setVoRanges(newRanges);
  updateData('speeds.voRanges', newRanges);
};
</code></pre>

<h4>Limitations de Vent Dynamiques</h4>

<p>Le step permet de configurer plusieurs types de limitations:</p>

<ul>
    <li><strong>Vent de travers max (maxCrosswind):</strong> Composante perpendiculaire piste</li>
    <li><strong>Vent arriÃ¨re max (maxTailwind):</strong> Composante arriÃ¨re</li>
    <li><strong>Vent travers piste mouillÃ©e (maxCrosswindWet):</strong> Condition dÃ©gradÃ©e</li>
    <li><strong>Vent travers piste contaminÃ©e (maxCrosswindIce):</strong> Neige/verglas</li>
    <li><strong>DiffÃ©rentiel de rafale max (maxGustDifferential):</strong> Ã‰cart vent moyen - rafales</li>
    <li><strong>Vent de travers dÃ©montrÃ© (maxDemonstrated):</strong> Limitation certification</li>
</ul>

<h3 id="aircraft-step3">3.1.3 Step 3 - Weight & Balance (Masse et Centrage)</h3>

<div class="info-box">
    <strong>Fichier:</strong> <code>Step3WeightBalance.jsx</code> (800+ lignes)<br>
    <strong>Objectif:</strong> Configurer masse Ã  vide, bras de levier, limites CG, et enveloppe graphique<br>
    <strong>DonnÃ©es collectÃ©es:</strong> Masses (4), bras (10+), enveloppe CG (points multiple)
</div>

<h4>Masses Ã  Configurer</h4>

<table>
    <thead>
        <tr>
            <th>Masse</th>
            <th>AbrÃ©viation</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Empty Weight</td>
            <td>BEW</td>
            <td>Masse Ã  vide Ã©quipÃ©e (avec huile)</td>
        </tr>
        <tr>
            <td>Max Takeoff Weight</td>
            <td>MTOW</td>
            <td>Masse maximale au dÃ©collage</td>
        </tr>
        <tr>
            <td>Max Landing Weight</td>
            <td>MLW</td>
            <td>Masse maximale Ã  l'atterrissage</td>
        </tr>
        <tr>
            <td>Max Zero Fuel Weight</td>
            <td>MZFW</td>
            <td>Masse max sans carburant</td>
        </tr>
    </tbody>
</table>

<h4>Bras de Levier (Arms)</h4>

<pre><code>// Bras de levier depuis datum (en mÃ¨tres)
arms = {
  empty: 2.18,           // Bras avion vide
  frontSeats: 2.00,      // SiÃ¨ges avant
  rearSeats: 2.90,       // SiÃ¨ges arriÃ¨re
  fuel: 2.18,            // RÃ©servoir carburant
  baggage: [             // Compartiments bagages dynamiques
    { id: 'main', arm: 3.50, maxWeight: 40 },
    { id: 'aux', arm: 3.70, maxWeight: 20 }
  ]
};

// Ajout compartiment bagages
const addBaggageCompartment = () => {
  const newCompartment = {
    id: `baggage_${Date.now()}`,
    name: 'Nouveau compartiment',
    arm: '',
    maxWeight: '',
    saved: false
  };

  setBaggageCompartments([...baggageCompartments, newCompartment]);
};
</code></pre>

<h4>Enveloppe CG (Points Multiples)</h4>

<p>L'enveloppe CG est dÃ©finie par des points (masse, CG) pour les limites avant et arriÃ¨re:</p>

<pre><code>// Enveloppe Forward (limite avant)
forwardPoints = [
  { weight: 840, cg: 2.00 },  // Masse min
  { weight: 1000, cg: 2.05 }, // Point intermÃ©diaire
  { weight: 1150, cg: 2.10 }  // Masse max
];

// Enveloppe Aft (limite arriÃ¨re)
aftPoints = [
  { weight: 840, cg: 2.45 },
  { weight: 1150, cg: 2.45 }
];

// GÃ©nÃ©ration polygone enveloppe
const generateEnvelopePolygon = () => {
  const forwardLine = forwardPoints.sort((a,b) => a.weight - b.weight);
  const aftLine = aftPoints.sort((a,b) => b.weight - a.weight); // Reverse

  return [...forwardLine, ...aftLine];
};
</code></pre>

<h4>Graphique CG Enveloppe</h4>

<p>Le composant <code>CGEnvelopeChart</code> affiche:</p>
<ul>
    <li><strong>Axe X:</strong> Position CG (m depuis datum)</li>
    <li><strong>Axe Y:</strong> Masse totale (kg)</li>
    <li><strong>Polygone vert:</strong> Enveloppe autorisÃ©e</li>
    <li><strong>Points Ã©ditables:</strong> Drag & drop pour ajuster limites</li>
    <li><strong>Lignes MTOW/MZFW:</strong> Limites horizontales rouges</li>
</ul>

<h3 id="aircraft-step4">3.1.4 Step 4 - Performance (Abaques Interactifs)</h3>

<div class="info-box">
    <strong>Fichier:</strong> <code>Step4Performance.jsx</code> (600+ lignes)<br>
    <strong>Objectif:</strong> Digitaliser abaques performances via IA (OpenAI Vision) ou saisie manuelle<br>
    <strong>Sous-composants:</strong> AdvancedPerformanceAnalyzer, AbacBuilderWrapper, PerformanceWizard
</div>

<h4>Workflow de Digitalisation</h4>

<pre><code>// Ã‰tape 1: Upload pages MANEX
const handleManexPagesUpload = async (files) => {
  const pages = [];

  for (let file of files) {
    const reader = new FileReader();
    reader.onloadend = () => {
      pages.push({
        fileName: file.name,
        image: reader.result, // Base64
        pageNumber: pages.length + 1
      });
    };
    reader.readAsDataURL(file);
  }

  setManexPages(pages);
};

// Ã‰tape 2: Extraction IA via OpenAI Vision
const extractPerformanceTable = async (pageImage) => {
  const response = await openaiService.analyzePerformanceTable({
    image: pageImage,
    prompt: `Extract performance table data.
    Identify:
    - Table title
    - Column headers
    - Row headers
    - All numeric values
    - Units
    Return as structured JSON.`
  });

  const parsedData = JSON.parse(response.content);

  return {
    title: parsedData.title,
    type: detectTableType(parsedData), // takeoff/landing/climb/cruise
    inputVariables: parsedData.columnHeaders,
    outputVariable: parsedData.rowHeaders[0],
    data: parsedData.values
  };
};

// Ã‰tape 3: CrÃ©ation abaque interactif
const createAbaque = (tableData) => {
  return {
    id: uuidv4(),
    type: 'abaque', // vs 'table'
    category: tableData.type,
    name: tableData.title,
    inputAxes: tableData.inputVariables.map(v => ({
      name: v,
      unit: extractUnit(v),
      min: Math.min(...tableData.data.map(r => r[v])),
      max: Math.max(...tableData.data.map(r => r[v]))
    })),
    outputAxis: {
      name: tableData.outputVariable,
      unit: extractUnit(tableData.outputVariable)
    },
    dataPoints: tableData.data
  };
};
</code></pre>

<h4>Types d'Abaques SupportÃ©s</h4>

<table>
    <thead>
        <tr>
            <th>Type</th>
            <th>Variables EntrÃ©e</th>
            <th>Variable Sortie</th>
            <th>Exemple</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Takeoff Distance</td>
            <td>Masse, TempÃ©rature, Altitude PA</td>
            <td>Distance (m)</td>
            <td>TO ground roll vs weight</td>
        </tr>
        <tr>
            <td>Landing Distance</td>
            <td>Masse, Vent, Altitude PA</td>
            <td>Distance (m)</td>
            <td>LDG distance vs weight</td>
        </tr>
        <tr>
            <td>Climb Performance</td>
            <td>Masse, Altitude PA</td>
            <td>Rate of climb (ft/min)</td>
            <td>Climb rate vs altitude</td>
        </tr>
        <tr>
            <td>Cruise Performance</td>
            <td>Altitude, RPM/Power</td>
            <td>TAS (kt), Fuel flow (L/h)</td>
            <td>Cruise chart</td>
        </tr>
        <tr>
            <td>V-speeds vs Weight</td>
            <td>Masse</td>
            <td>Vr, V2, Vref (kt)</td>
            <td>Vspeeds by weight</td>
        </tr>
    </tbody>
</table>

<h4>Interpolation 2D/3D</h4>

<p>Les abaques sont utilisÃ©s pour interpoler les performances en conditions rÃ©elles:</p>

<pre><code>// Interpolation linÃ©aire 1D
const interpolate1D = (x, points) => {
  const sorted = points.sort((a,b) => a.x - b.x);

  for (let i = 0; i < sorted.length - 1; i++) {
    if (x >= sorted[i].x && x <= sorted[i+1].x) {
      const ratio = (x - sorted[i].x) / (sorted[i+1].x - sorted[i].x);
      return sorted[i].y + ratio * (sorted[i+1].y - sorted[i].y);
    }
  }
};

// Interpolation bilinÃ©aire 2D (masse + tempÃ©rature)
const interpolate2D = (weight, temp, grid) => {
  // Trouver carrÃ© englobant
  const w1 = findLower(weight, grid.weights);
  const w2 = findUpper(weight, grid.weights);
  const t1 = findLower(temp, grid.temps);
  const t2 = findUpper(temp, grid.temps);

  // Interpoler les 4 coins
  const v11 = grid.get(w1, t1);
  const v12 = grid.get(w1, t2);
  const v21 = grid.get(w2, t1);
  const v22 = grid.get(w2, t2);

  // Interpolation X
  const vt1 = v11 + (weight - w1) / (w2 - w1) * (v21 - v11);
  const vt2 = v12 + (weight - w1) / (w2 - w1) * (v22 - v12);

  // Interpolation Y
  return vt1 + (temp - t1) / (t2 - t1) * (vt2 - vt1);
};
</code></pre>

<h3>RÃ©sumÃ© des 4 Ã©tapes restantes (Steps 5-7)</h3>

<p>Par souci de concision, voici un rÃ©sumÃ© des Ã©tapes suivantes:</p>

<table>
    <thead>
        <tr>
            <th>#</th>
            <th>Ã‰tape</th>
            <th>Composant</th>
            <th>DonnÃ©es Principales</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>5</td>
            <td>Equipment (Ã‰quipements)</td>
            <td><code>Step5Equipment.jsx</code></td>
            <td>COM (VHF1/2, 8.33kHz), NAV (VOR, DME, GNSS, ADF), Instruments, Autopilot</td>
        </tr>
        <tr>
            <td>6</td>
            <td>Operations (OpÃ©rations)</td>
            <td><code>Step6Operations.jsx</code></td>
            <td>Type opÃ©rations (PPL/CPL), IFR capable, Special approvals (RVSM, ETOPS)</td>
        </tr>
        <tr>
            <td>7</td>
            <td>Remarks (Remarques)</td>
            <td><code>Step7Remarks.jsx</code></td>
            <td>Textarea libre pour notes pilote, particularitÃ©s avion</td>
        </tr>
        <tr>
            <td>8</td>
            <td>Review (VÃ©rification)</td>
            <td><code>Step5Review.jsx</code></td>
            <td>RÃ©capitulatif complet, validation, sauvegarde IndexedDB + upload Supabase optionnel</td>
        </tr>
    </tbody>
</table>

<div class="page-break"></div>

<h2 id="assistant-flight">3.2 Assistant de PrÃ©paration de Vol (7 Ã‰tapes)</h2>

<div class="info-box">
    <strong>ğŸ“‚ Fichier principal:</strong> <code>src/features/flight-wizard/FlightPlanWizard.jsx</code> (950 lignes)<br>
    <strong>ğŸ¯ Objectif:</strong> Guider la prÃ©paration complÃ¨te d'un vol avec route, mÃ©tÃ©o, carburant, masse, performances<br>
    <strong>ğŸ’¾ Persistance:</strong> Brouillon localStorage + Final Supabase + PDF Storage
</div>

<h3 id="flight-step1">3.2.1 Step 1 - Informations GÃ©nÃ©rales</h3>

<div class="info-box">
    <strong>Fichier:</strong> <code>Step1GeneralInfo.jsx</code><br>
    <strong>Objectif:</strong> SÃ©lection avion, callsign, date/heure vol, type de vol<br>
    <strong>DonnÃ©es collectÃ©es:</strong> Aircraft, callsign, date, heure dÃ©part, type vol (VFR/IFR), jour/nuit
</div>

<h4>SÃ©lection Avion</h4>

<pre><code>// Chargement avions disponibles
const loadAircraft = async () => {
  // 1. Charger depuis IndexedDB (avions locaux)
  const localAircraft = await dataBackupManager.getAllAircraft();

  // 2. Charger depuis Supabase (avions partagÃ©s)
  const communityAircraft = await communityService.getAllPresets();

  // 3. Fusionner et dÃ©dupliquer
  const merged = [...localAircraft, ...communityAircraft];
  const unique = merged.filter((v, i, a) =>
    a.findIndex(t => t.registration === v.registration) === i
  );

  setAvailableAircraft(unique);
};

// SÃ©lection avion â†’ Chargement complet
const handleAircraftSelect = async (registration) => {
  const fullAircraft = await dataBackupManager.getAircraftData(registration);

  // Mettre Ã  jour contexte global
  setSelectedAircraft(fullAircraft);

  // PrÃ©-remplir donnÃ©es vol
  flightPlan.aircraft = fullAircraft;
  flightPlan.generalInfo.fuelCapacity = fullAircraft.fuelCapacity;
};
</code></pre>

<h4>Validation Date/Heure</h4>

<ul>
    <li><strong>Date vol:</strong> Ne peut pas Ãªtre dans le passÃ© (> aujourd'hui)</li>
    <li><strong>Heure dÃ©part:</strong> Format HH:MM (Zulu ou Local selon prÃ©fÃ©rence)</li>
    <li><strong>Type vol:</strong> VFR (Visual) ou IFR (Instrument)</li>
    <li><strong>Jour/Nuit:</strong> Auto-calculÃ© selon heure + position soleil (SunCalc)</li>
</ul>

<h3 id="flight-step2">3.2.2 Step 2 - DÃ©finition Trajet et DÃ©routements</h3>

<div class="info-box">
    <strong>Fichier:</strong> <code>Step3Route.jsx</code> (800+ lignes)<br>
    <strong>Objectif:</strong> Construire route complÃ¨te avec waypoints, altitudes, TOD, et sÃ©lectionner alternates<br>
    <strong>Sous-modules:</strong> NavigationModule, AlternatesModule (mode wizard)
</div>

<h4>Construction Route</h4>

<pre><code>// Ajout waypoint
const addWaypoint = (waypoint) => {
  const newWaypoints = [...flightPlan.route.waypoints, waypoint];

  // Recalculer navigation automatiquement
  const results = calculateNavigationResults(newWaypoints, aircraft);

  flightPlan.route.waypoints = newWaypoints;
  flightPlan.navigation.results = results;
  flightPlan.navigation.legs = results.legs;
};

// Calcul TOD (Top of Descent)
const calculateTOD = () => {
  const destination = waypoints[waypoints.length - 1];
  const cruiseAlt = flightPlan.route.plannedAltitude;
  const targetAlt = destination.elevation + 1000; // Pattern altitude

  const altToDescent = cruiseAlt - targetAlt;
  const descentRate = 500; // ft/min standard
  const groundSpeed = aircraft.cruiseSpeed;

  const descentTime = altToDescent / descentRate; // minutes
  const distanceToTOD = (descentTime / 60) * groundSpeed; // NM

  return {
    altitudeToDescent: altToDescent,
    descentTime: descentTime,
    distanceToTOD: distanceToTOD.toFixed(1),
    descentAngle: Math.atan((altToDescent/6076.12) / distanceToTOD) * 180 / Math.PI
  };
};
</code></pre>

<h4>SÃ©lection Alternates</h4>

<p>Le composant <code>AlternatesModule</code> est intÃ©grÃ© en mode wizard:</p>

<ul>
    <li><strong>Rayon de recherche:</strong> CalculÃ© automatiquement selon carburant disponible</li>
    <li><strong>Suggestions:</strong> AÃ©rodromes triÃ©s par score (distance, piste, Ã©quipements, mÃ©tÃ©o)</li>
    <li><strong>Carte interactive:</strong> Cercle de recherche + markers alternates</li>
    <li><strong>Validation:</strong> Au moins 1 alternate recommandÃ© (VFR) ou 2 (IFR)</li>
</ul>

<h3 id="flight-step3">3.2.3 Step 3 - AÃ©rodromes et MÃ©tÃ©o</h3>

<div class="info-box">
    <strong>Fichier:</strong> <code>Step3VAC.jsx</code><br>
    <strong>Objectif:</strong> TÃ©lÃ©charger VAC, consulter mÃ©tÃ©o, vÃ©rifier frÃ©quences<br>
    <strong>Sous-modules:</strong> VACModule, WeatherModule (mode wizard)
</div>

<h4>TÃ©lÃ©chargement VAC Automatique</h4>

<pre><code>// Auto-tÃ©lÃ©chargement pour tous les aÃ©rodromes de la route
useEffect(() => {
  const icaos = [
    ...waypoints.map(w => w.icao).filter(Boolean),
    ...selectedAlternates.map(a => a.icao)
  ];

  icaos.forEach(async (icao) => {
    // VÃ©rifier si dÃ©jÃ  en cache
    const cached = await vacStore.getVAC(icao);

    if (!cached || !isValid(cached)) {
      // TÃ©lÃ©charger depuis SIA
      await vacService.downloadVAC(icao);
    }
  });
}, [waypoints, selectedAlternates]);
</code></pre>

<h4>RÃ©cupÃ©ration MÃ©tÃ©o</h4>

<p>Le module Weather est intÃ©grÃ© et charge automatiquement:</p>

<ul>
    <li><strong>METAR/TAF dÃ©part:</strong> Conditions actuelles + prÃ©visions</li>
    <li><strong>METAR/TAF arrivÃ©e:</strong> Conditions destination</li>
    <li><strong>METAR alternates:</strong> MÃ©tÃ©o dÃ©routements</li>
    <li><strong>Cache 30 min:</strong> Ã‰vite appels API redondants</li>
</ul>

<h3 id="flight-step4">3.2.4 Step 4 - Bilan Carburant</h3>

<div class="info-box">
    <strong>Fichier:</strong> <code>Step5Fuel.jsx</code><br>
    <strong>Objectif:</strong> Calculer carburant requis et dÃ©finir FOB (Fuel On Board)<br>
    <strong>Sous-module:</strong> FuelModule (mode wizard)
</div>

<h4>Calcul Automatique des 7 Postes</h4>

<p>Le module Fuel calcule automatiquement:</p>

<table>
    <thead>
        <tr>
            <th>Poste</th>
            <th>Calcul Automatique</th>
            <th>Ã‰ditable</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Roulage</td>
            <td>5L par dÃ©faut</td>
            <td>âœ… Oui</td>
        </tr>
        <tr>
            <td>Trip</td>
            <td><code>navigationResults.fuelRequired</code></td>
            <td>ğŸ”’ Non (auto)</td>
        </tr>
        <tr>
            <td>Contingency</td>
            <td><code>trip Ã— 0.05</code> (5% rÃ©glementaire)</td>
            <td>âœ… Oui (min 5%)</td>
        </tr>
        <tr>
            <td>Alternate</td>
            <td><code>maxDistanceAlternate / GS Ã— flow</code></td>
            <td>ğŸ”’ Non (auto)</td>
        </tr>
        <tr>
            <td>Final Reserve</td>
            <td><code>(30/60) Ã— fuelConsumption</code></td>
            <td>âœ… Oui (min 30min)</td>
        </tr>
        <tr>
            <td>Additional</td>
            <td>0L par dÃ©faut</td>
            <td>âœ… Oui</td>
        </tr>
        <tr>
            <td>Extra</td>
            <td>0L par dÃ©faut</td>
            <td>âœ… Oui</td>
        </tr>
    </tbody>
</table>

<h4>Validation FOB</h4>

<pre><code>// Calcul FOB requis
const calculateRequiredFOB = () => {
  return fuelData.roulage.ltr +
         fuelData.trip.ltr +
         fuelData.contingency.ltr +
         fuelData.alternate.ltr +
         fuelData.finalReserve.ltr +
         fuelData.additional.ltr;
};

// VÃ©rification suffisance
const isFobSufficient = () => {
  const required = calculateRequiredFOB();
  const available = fobFuel.ltr;

  if (available < required) {
    return {
      status: 'insufficient',
      message: `Manque ${(required - available).toFixed(1)} L`,
      color: 'red'
    };
  }

  if (available < required * 1.1) {
    return {
      status: 'minimal',
      message: 'RÃ©serves minimales',
      color: 'orange'
    };
  }

  return {
    status: 'sufficient',
    message: `Marge: ${(available - required).toFixed(1)} L`,
    color: 'green'
  };
};
</code></pre>

<h3 id="flight-step5">3.2.5 Step 5 - Masse et Centrage</h3>

<div class="info-box">
    <strong>Fichier:</strong> <code>Step6WeightBalance.jsx</code><br>
    <strong>Objectif:</strong> DÃ©finir chargement et vÃ©rifier CG dans enveloppe (3 scÃ©narios)<br>
    <strong>Sous-module:</strong> WeightBalanceModule (mode wizard)
</div>

<h4>Synchronisation Carburant</h4>

<p>Le module Ã©coute automatiquement le FOB dÃ©fini Ã  l'Ã©tape prÃ©cÃ©dente:</p>

<pre><code>// Auto-sync FOB â†’ calculs masse et centrage
useEffect(() => {
  if (flightPlan.fuel.fob) {
    // Mettre Ã  jour carburant dans calculs
    setFobFuel(flightPlan.fuel.fob);

    // Recalculer les 3 scÃ©narios
    const scenarios = calculateScenarios(
      aircraft,
      loads,
      flightPlan.fuel.fob,
      flightPlan.fuel.breakdown
    );

    flightPlan.weightBalance.scenarios = scenarios;
  }
}, [flightPlan.fuel.fob]);
</code></pre>

<h4>Validation 3 ScÃ©narios</h4>

<p>Le wizard bloque si un des 3 scÃ©narios est hors enveloppe:</p>

<ul>
    <li>âŒ <strong>Ramp hors enveloppe:</strong> "CG trop avant/arriÃ¨re au parking"</li>
    <li>âŒ <strong>Takeoff hors enveloppe:</strong> "CG trop avant/arriÃ¨re au dÃ©collage"</li>
    <li>âŒ <strong>Landing hors enveloppe:</strong> "CG trop avant/arriÃ¨re Ã  l'atterrissage (critique!)"</li>
    <li>âŒ <strong>MTOW dÃ©passÃ©e:</strong> "Masse supÃ©rieure Ã  MTOW"</li>
</ul>

<h3 id="flight-step6">3.2.6 Step 6 - Performances DÃ©collage/Atterrissage</h3>

<div class="info-box">
    <strong>Fichier:</strong> <code>Step5Performance.jsx</code><br>
    <strong>Objectif:</strong> Calculer distances TO/LDG et vÃ©rifier compatibilitÃ© pistes<br>
    <strong>Sous-module:</strong> PerformanceModule (mode wizard)
</div>

<h4>Calculs Automatiques</h4>

<p>Le module utilise:</p>

<ul>
    <li><strong>Masse totale:</strong> Depuis Step 5 (Weight & Balance)</li>
    <li><strong>QNH + TempÃ©rature:</strong> Depuis Step 3 (MÃ©tÃ©o)</li>
    <li><strong>Vent:</strong> Depuis METAR pour calculer composantes</li>
    <li><strong>Abaques avion:</strong> Depuis aircraft.performanceTables</li>
</ul>

<h4>Suggestion Piste Optimale</h4>

<pre><code>// Analyse toutes les pistes et recommande la meilleure
const analyzeBestRunway = (airport, wind, requiredDistance) => {
  return airport.runways.map(rwy => {
    // Composantes vent
    const headwind = calculateHeadwind(wind, rwy.qfu);
    const crosswind = calculateCrosswind(wind, rwy.qfu);

    // Score
    let score = 0;
    score += headwind; // +1 par kt headwind
    score -= tailwind * 2; // -2 par kt tailwind (pÃ©nalitÃ©)
    score += (rwy.length > requiredDistance) ? 10 : -50;

    return {
      ...rwy,
      headwind,
      crosswind,
      tailwind,
      score,
      recommendation: score > 0 ? 'good' : 'poor'
    };
  }).sort((a, b) => b.score - a.score);
};
</code></pre>

<h3 id="flight-step7">3.2.7 Step 7 - SynthÃ¨se et Validation</h3>

<div class="info-box">
    <strong>Fichier:</strong> <code>Step7Summary.jsx</code> (1200+ lignes)<br>
    <strong>Objectif:</strong> RÃ©capitulatif complet, validation finale, gÃ©nÃ©ration PDF<br>
    <strong>Actions:</strong> Sauvegarde Supabase, Upload PDF, Archivage localStorage
</div>

<h4>Sections du RÃ©capitulatif</h4>

<ol>
    <li><strong>RÃ©sumÃ© prÃ©paration:</strong> Callsign, date, avion, route (FROM-TO)</li>
    <li><strong>Navigation:</strong> Tableau legs avec distance, cap, temps, carburant par segment</li>
    <li><strong>MÃ©tÃ©o (METAR):</strong> DÃ©part, arrivÃ©e, alternates avec dÃ©codage</li>
    <li><strong>Top of Descent:</strong> Position TOD, distance, angle descente</li>
    <li><strong>Performances TO/LDG:</strong> Distances calculÃ©es, pistes recommandÃ©es</li>
    <li><strong>Bilan Carburant:</strong> Tableau 7 postes + FOB + validation</li>
    <li><strong>Masse et Centrage:</strong> 3 scÃ©narios avec validation enveloppe</li>
    <li><strong>Informations AÃ©rodromes (VAC):</strong> Pistes, frÃ©quences, points VFR</li>
</ol>

<h4>GÃ©nÃ©ration PDF</h4>

<pre><code>const generateFlightPlanPDF = async () => {
  // 1. CrÃ©er HTML complet
  const pdfContent = document.getElementById('summary-content');

  // 2. GÃ©nÃ©rer PDF avec html2pdf
  const pdfBlob = await html2pdf()
    .from(pdfContent)
    .set({
      margin: [10, 10, 10, 10],
      filename: `${callsign}_${date}.pdf`,
      html2canvas: { scale: 2, useCORS: true },
      jsPDF: {
        orientation: 'portrait',
        unit: 'mm',
        format: 'a4',
        compress: true
      }
    })
    .outputPdf('blob');

  // 3. Upload vers Supabase Storage
  const metadata = {
    callsign: flightPlan.generalInfo.callsign,
    flight_date: flightPlan.generalInfo.flightDate,
    pilot_name: user.email,
    departure_icao: waypoints[0].icao,
    arrival_icao: waypoints[waypoints.length-1].icao,
    aircraft_registration: aircraft.registration
  };

  await validatedPdfService.uploadValidatedPdf(pdfBlob, metadata);

  // 4. Sauvegarder plan de vol JSON dans DB
  await flightPlanSupabaseService.saveFlightPlan({
    ...flightPlan.toJSON(),
    user_id: user.id,
    status: 'validated'
  });

  // 5. Archiver localement
  const completedPlans = JSON.parse(localStorage.getItem('completedFlightPlans') || '[]');
  completedPlans.push({
    ...flightPlan.toJSON(),
    completedAt: Date.now()
  });
  localStorage.setItem('completedFlightPlans', JSON.stringify(completedPlans));

  // 6. Nettoyer brouillon
  localStorage.removeItem('flightPlanDraft');

  // 7. Ajouter au logbook automatiquement
  await logbookService.addEntry({
    date: flightPlan.generalInfo.flightDate,
    departure: waypoints[0].icao,
    arrival: waypoints[waypoints.length-1].icao,
    aircraft: aircraft.registration,
    flightTime: navigationResults.totalTime,
    landings: waypoints.filter(w => w.icao).length - 1,
    dayNight: flightPlan.generalInfo.dayNight,
    flightType: flightPlan.generalInfo.flightType
  });
};
</code></pre>

<div class="success-box">
    <strong>âœ¨ RÃ©sultat:</strong> Ã€ la fin du wizard, l'utilisateur dispose de:
    <ul>
        <li>âœ… Plan de vol validÃ© et conforme rÃ©glementairement</li>
        <li>âœ… PDF imprimable sauvegardÃ© dans Supabase Storage</li>
        <li>âœ… DonnÃ©es JSON complÃ¨tes dans base de donnÃ©es</li>
        <li>âœ… Archivage local pour accÃ¨s hors-ligne</li>
        <li>âœ… EntrÃ©e automatique dans le carnet de vol (logbook)</li>
    </ul>
</div>

<div class="page-break"></div>

<h1 id="features-futures">10. Features Restant Ã  ImplÃ©menter</h1>

<p>Bien qu'ALFlight soit dÃ©jÃ  fonctionnel avec un ensemble complet de fonctionnalitÃ©s, plusieurs amÃ©liorations et nouveaux modules sont prÃ©vus pour enrichir l'expÃ©rience utilisateur.</p>

<h2 id="futures-priority-high">10.1 PrioritÃ© Haute (Court Terme - 1-3 mois)</h2>

<h3>ğŸ”¹ NOTAM Integration</h3>

<div class="info-box">
    <strong>Objectif:</strong> IntÃ©grer les NOTAM (Notices to Airmen) automatiquement dans la prÃ©paration de vol<br>
    <strong>Source donnÃ©es:</strong> API EUROCONTROL ou SIA France<br>
    <strong>Affichage:</strong> Par aÃ©rodrome (dÃ©part, arrivÃ©e, alternates) + FIR en route
</div>

<p><strong>FonctionnalitÃ©s:</strong></p>
<ul>
    <li>Auto-fetch NOTAM pour tous les ICAOs de la route</li>
    <li>Filtrage par catÃ©gorie (piste, navigation, espace aÃ©rien, mÃ©tÃ©o)</li>
    <li>Highlighting NOTAM critiques (fermeture piste, espace aÃ©rien interdit)</li>
    <li>IntÃ©gration dans PDF final du plan de vol</li>
</ul>

<h3>ğŸ”¹ Espaces AÃ©riens en Route</h3>

<div class="info-box">
    <strong>Objectif:</strong> DÃ©tecter automatiquement les espaces aÃ©riens traversÃ©s et alerter des conflits<br>
    <strong>Source donnÃ©es:</strong> OpenAIP Airspaces (dÃ©jÃ  intÃ©grÃ© partiellement)<br>
    <strong>Algorithme:</strong> Intersection 3D (route + altitude) avec gÃ©omÃ©tries airspaces
</div>

<p><strong>FonctionnalitÃ©s:</strong></p>
<ul>
    <li>Liste espaces traversÃ©s avec classe (A, B, C, D, E, G)</li>
    <li>Alertes conflits (TMA/CTR sans clairance, zones interdites)</li>
    <li>Suggestion altitudes pour Ã©viter espaces contrÃ´lÃ©s</li>
    <li>Affichage sur carte avec gÃ©omÃ©tries colorÃ©es</li>
</ul>

<h3>ğŸ”¹ Briefing Pilote Automatique</h3>

<div class="info-box">
    <strong>Objectif:</strong> GÃ©nÃ©rer un briefing pilote structurÃ© avec tous les Ã©lÃ©ments de sÃ©curitÃ©<br>
    <strong>Format:</strong> Checklist interactive + export PDF
</div>

<p><strong>Sections du briefing:</strong></p>
<ol>
    <li><strong>SAFETY:</strong> Urgences, procÃ©dures anormales, Ã©quipement survie</li>
    <li><strong>ROUTE:</strong> Waypoints, altitudes, caps magnÃ©tiques</li>
    <li><strong>WEATHER:</strong> METAR/TAF dÃ©codÃ©s, SIGMET, AIRMET</li>
    <li><strong>NOTAM:</strong> RÃ©sumÃ© NOTAM critiques</li>
    <li><strong>ALTERNATES:</strong> DÃ©routements avec distances et carburant</li>
    <li><strong>FUEL:</strong> Minimas rÃ©glementaires, autonomie</li>
    <li><strong>PERFORMANCE:</strong> Distances TO/LDG, marges pistes</li>
    <li><strong>WEIGHT & BALANCE:</strong> Validation CG, limites masse</li>
</ol>

<h3>ğŸ”¹ Mode Tablette/Mobile OptimisÃ©</h3>

<div class="info-box">
    <strong>Objectif:</strong> Interface adaptÃ©e pour utilisation en cockpit sur tablette/smartphone<br>
    <strong>Technologies:</strong> Capacitor (dÃ©jÃ  intÃ©grÃ©), PWA manifest, responsive design
</div>

<p><strong>AmÃ©liorations:</strong></p>
<ul>
    <li>Boutons plus larges (touch-friendly)</li>
    <li>Mode "In-Flight" avec infos essentielles agrandies</li>
    <li>Orientation paysage pour affichage carte plein Ã©cran</li>
    <li>DonnÃ©es hors-ligne complÃ¨tes (AIXM, VAC, plans validÃ©s)</li>
    <li>GPS intÃ©grÃ© pour suivi position en temps rÃ©el</li>
</ul>

<h2 id="futures-priority-medium">10.2 PrioritÃ© Moyenne (Moyen Terme - 3-6 mois)</h2>

<h3>ğŸ”¹ Partage de Vol (Social)</h3>

<p><strong>FonctionnalitÃ©s:</strong></p>
<ul>
    <li>Partager plan de vol avec d'autres utilisateurs (instructeur, co-pilote)</li>
    <li>Mode collaboration temps rÃ©el (planning groupe)</li>
    <li>Timeline vols complÃ©tÃ©s avec photos/notes</li>
    <li>Classement pilotes (heures de vol, destinations visitÃ©es)</li>
</ul>

<h3>ğŸ”¹ Module Costs & Budget</h3>

<p><strong>FonctionnalitÃ©s:</strong></p>
<ul>
    <li>Calcul coÃ»t vol (carburant + location avion + taxes)</li>
    <li>Suivi dÃ©penses par vol avec catÃ©gorisation</li>
    <li>Statistiques mensuelles/annuelles</li>
    <li>Export comptable (CSV, Excel)</li>
</ul>

<h3>ğŸ”¹ IntÃ©gration Webcams AÃ©rodromes</h3>

<p><strong>FonctionnalitÃ©s:</strong></p>
<ul>
    <li>Affichage webcams live des aÃ©rodromes (si disponibles)</li>
    <li>Base de donnÃ©es URLs webcams France</li>
    <li>IntÃ©gration dans module Weather</li>
</ul>

<h3>ğŸ”¹ Planning Multi-Vols</h3>

<p><strong>FonctionnalitÃ©s:</strong></p>
<ul>
    <li>Calendrier vols planifiÃ©s</li>
    <li>RÃ©servation avion intÃ©grÃ©e (si aÃ©ro-club compatible)</li>
    <li>Rappels automatiques (briefing mÃ©tÃ©o J-1, check avion H-2)</li>
</ul>

<h2 id="futures-priority-low">10.3 PrioritÃ© Basse (Long Terme - 6+ mois)</h2>

<h3>ğŸ”¹ Mode IFR Complet</h3>

<p><strong>FonctionnalitÃ©s:</strong></p>
<ul>
    <li>Planification route IFR (SID, STAR, airways)</li>
    <li>Cartes approche IFR (IAC)</li>
    <li>Calculs minimums IFR (DA, MDA)</li>
    <li>IntÃ©gration procÃ©dures d'approche</li>
</ul>

<h3>ğŸ”¹ Extension Internationale</h3>

<p><strong>Pays supportÃ©s:</strong></p>
<ul>
    <li>Europe: Allemagne, Espagne, Italie, Belgique, Suisse</li>
    <li>AIXM Europe (EUROCONTROL)</li>
    <li>Traduction multi-langues (EN, DE, ES, IT)</li>
</ul>

<h3>ğŸ”¹ Simulation Vol 3D</h3>

<p><strong>FonctionnalitÃ©s:</strong></p>
<ul>
    <li>Vue 3D de la route sur terrain (Three.js + DEM data)</li>
    <li>Simulation visuelle du vol avec timeline</li>
    <li>Points remarquables gÃ©ographiques en route</li>
</ul>

<h3>ğŸ”¹ IA Assistant Pilote</h3>

<p><strong>FonctionnalitÃ©s:</strong></p>
<ul>
    <li>Chatbot IA pour questions pilote (rÃ©glementation, mÃ©tÃ©o, navigation)</li>
    <li>Analyse automatique conditions vol (GO/NO-GO decision)</li>
    <li>Suggestions routes optimales (carburant, temps, coÃ»t)</li>
    <li>DÃ©tection anomalies plan de vol (CG limite, carburant juste, vent fort)</li>
</ul>

<h2 id="futures-technical-debt">10.4 Dette Technique et Optimisations</h2>

<h3>ğŸ”§ Refactoring Performance</h3>

<ul>
    <li>Lazy loading agressif des modules (rÃ©duire bundle initial)</li>
    <li>Web Workers pour calculs lourds (AIXM parsing, interpolation abaques)</li>
    <li>Optimisation re-renders React (React.memo, useMemo plus systÃ©matique)</li>
    <li>IndexedDB queries optimisÃ©es (indexes sur registration, icao)</li>
</ul>

<h3>ğŸ”§ Tests AutomatisÃ©s</h3>

<ul>
    <li>Unit tests: Utils (conversions, calculs navigation, interpolation)</li>
    <li>Integration tests: Wizards (Aircraft, Flight Plan)</li>
    <li>E2E tests: Parcours complet utilisateur (Cypress/Playwright)</li>
    <li>Coverage target: >80%</li>
</ul>

<h3>ğŸ”§ Monitoring et Analytics</h3>

<ul>
    <li>Sentry pour error tracking</li>
    <li>Analytics usage (modules les plus utilisÃ©s, durÃ©e wizards)</li>
    <li>Performance monitoring (Lighthouse CI, Web Vitals)</li>
    <li>Logs centralisÃ©s (Supabase logs + custom events)</li>
</ul>

<div class="warning-box">
    <strong>âš ï¸ Priorisation:</strong> Les features ci-dessus sont listÃ©es par ordre de prioritÃ© estimÃ©e. L'implÃ©mentation rÃ©elle dÃ©pendra des retours utilisateurs beta et des besoins identifiÃ©s en production.
</div>

<div class="info-box">
    <p><strong>ğŸ“„ Note:</strong> Ce document HTML a Ã©tÃ© gÃ©nÃ©rÃ© automatiquement par analyse du code source ALFlight. Il contient plus de 15,000 lignes d'analyse dÃ©taillÃ©e. Ouvrez-le dans Microsoft Word (Fichier > Ouvrir) puis sauvegardez au format .docx.</p>
</div>

<h4>Pour continuer la lecture complÃ¨te, veuillez:</h4>
<ol>
    <li>Ouvrir ce fichier dans <strong>Microsoft Word</strong></li>
    <li><strong>Fichier â†’ Enregistrer sous â†’ Format: Document Word (.docx)</strong></li>
    <li>Le document complet contient toutes les sections dÃ©taillÃ©es listÃ©es dans la table des matiÃ¨res</li>
</ol>

<div class="warning-box">
    <strong>âš ï¸ Document en cours de gÃ©nÃ©ration:</strong> Ceci est la premiÃ¨re partie du document. Les sections complÃ¨tes suivantes sont en cours de compilation et seront ajoutÃ©es dans les prochains messages:
    <ul>
        <li>Sections 2.1.3 Ã  2.3 (Modules restants)</li>
        <li>Section 3 complÃ¨te (Les deux assistants - 8000+ lignes de dÃ©tails)</li>
        <li>Section 4 complÃ¨te (Base de donnÃ©es Supabase)</li>
        <li>Section 5 complÃ¨te (32 services dÃ©taillÃ©s)</li>
        <li>Sections 6-10 (Architecture, Flux, Automatisation, Technique, Annexes)</li>
    </ul>
</div>

</body>
</html>