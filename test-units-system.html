<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test du syst√®me d'unit√©s</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #1f2937;
            margin-bottom: 30px;
        }
        h2 {
            color: #374151;
            margin-top: 30px;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e5e7eb;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-weight: 600;
            margin-left: 10px;
        }
        .status.success {
            background: #10b981;
            color: white;
        }
        .status.info {
            background: #3b82f6;
            color: white;
        }
        .status.warning {
            background: #f59e0b;
            color: white;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .test-item {
            background: #f9fafb;
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
        }
        .test-item strong {
            color: #374151;
            display: block;
            margin-bottom: 5px;
        }
        .test-item .value {
            color: #111827;
            font-size: 18px;
            font-weight: 600;
        }
        .unit-selector {
            margin: 15px 0;
            padding: 15px;
            background: #eff6ff;
            border-radius: 6px;
            border: 1px solid #3b82f6;
        }
        .unit-selector label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #1e40af;
        }
        .unit-selector select {
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid #d1d5db;
            font-size: 14px;
            margin-right: 10px;
            background: white;
        }
        button {
            padding: 10px 20px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background: #2563eb;
        }
        .log {
            background: #1f2937;
            color: #10b981;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 15px;
        }
        .log .entry {
            margin-bottom: 5px;
        }
        .log .timestamp {
            color: #6b7280;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <h1>üß™ Test du syst√®me d'unit√©s ALFlight</h1>

    <div class="test-section">
        <h2>√âtat du syst√®me <span class="status success">Actif</span></h2>
        <p>Test du syst√®me de pr√©f√©rences d'unit√©s avec conversion automatique.</p>
        
        <div class="unit-selector">
            <label>S√©lectionnez les unit√©s pour tester:</label>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                <div>
                    <label style="font-size: 12px; font-weight: normal;">Distance:</label>
                    <select id="unit-distance">
                        <option value="nm">NM (Nautique)</option>
                        <option value="km">km (M√©trique)</option>
                        <option value="mi">mi (Terrestre)</option>
                    </select>
                </div>
                <div>
                    <label style="font-size: 12px; font-weight: normal;">Altitude:</label>
                    <select id="unit-altitude">
                        <option value="ft">ft (Pieds)</option>
                        <option value="m">m (M√®tres)</option>
                        <option value="FL">FL (Niveau)</option>
                    </select>
                </div>
                <div>
                    <label style="font-size: 12px; font-weight: normal;">Vitesse:</label>
                    <select id="unit-speed">
                        <option value="kt">kt (N≈ìuds)</option>
                        <option value="km/h">km/h</option>
                        <option value="mph">mph</option>
                        <option value="m/s">m/s</option>
                    </select>
                </div>
                <div>
                    <label style="font-size: 12px; font-weight: normal;">Temp√©rature:</label>
                    <select id="unit-temperature">
                        <option value="C">¬∞C (Celsius)</option>
                        <option value="F">¬∞F (Fahrenheit)</option>
                    </select>
                </div>
                <div>
                    <label style="font-size: 12px; font-weight: normal;">Pression:</label>
                    <select id="unit-pressure">
                        <option value="hPa">hPa</option>
                        <option value="inHg">inHg</option>
                        <option value="mb">mb</option>
                    </select>
                </div>
                <div>
                    <label style="font-size: 12px; font-weight: normal;">Carburant:</label>
                    <select id="unit-fuel">
                        <option value="ltr">L (Litres)</option>
                        <option value="gal">gal (US)</option>
                        <option value="kg">kg</option>
                        <option value="lbs">lbs</option>
                    </select>
                </div>
            </div>
            <div style="margin-top: 15px;">
                <button onclick="applyUnits()">Appliquer les unit√©s</button>
                <button onclick="testEurope()" style="background: #10b981;">Preset Europe</button>
                <button onclick="testUSA()" style="background: #f59e0b;">Preset USA</button>
                <button onclick="testMetric()" style="background: #8b5cf6;">Preset M√©trique</button>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>Valeurs de test avec conversion</h2>
        
        <h3>Navigation</h3>
        <div class="test-grid">
            <div class="test-item">
                <strong>Distance parcourue:</strong>
                <div class="value" id="distance-value">125 NM</div>
                <small>Valeur source: 125 NM</small>
            </div>
            <div class="test-item">
                <strong>Altitude de croisi√®re:</strong>
                <div class="value" id="altitude-value">4500 ft</div>
                <small>Valeur source: 4500 ft</small>
            </div>
            <div class="test-item">
                <strong>Vitesse vraie (TAS):</strong>
                <div class="value" id="speed-value">108 kt</div>
                <small>Valeur source: 108 kt</small>
            </div>
        </div>

        <h3>M√©t√©o</h3>
        <div class="test-grid">
            <div class="test-item">
                <strong>Temp√©rature:</strong>
                <div class="value" id="temp-value">15¬∞C</div>
                <small>Valeur source: 15¬∞C</small>
            </div>
            <div class="test-item">
                <strong>Pression QNH:</strong>
                <div class="value" id="pressure-value">1013 hPa</div>
                <small>Valeur source: 1013 hPa</small>
            </div>
            <div class="test-item">
                <strong>Vent:</strong>
                <div class="value" id="wind-value">15 kt</div>
                <small>Valeur source: 15 kt</small>
            </div>
        </div>

        <h3>Carburant</h3>
        <div class="test-grid">
            <div class="test-item">
                <strong>Quantit√© embarqu√©e:</strong>
                <div class="value" id="fuel-value">120 L</div>
                <small>Valeur source: 120 L</small>
            </div>
            <div class="test-item">
                <strong>Consommation:</strong>
                <div class="value" id="consumption-value">35 L/h</div>
                <small>Valeur source: 35 L/h</small>
            </div>
            <div class="test-item">
                <strong>Poids carburant:</strong>
                <div class="value" id="fuel-weight-value">96 kg</div>
                <small>Valeur source: 96 kg (densit√© 0.8)</small>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>Journal des √©v√©nements</h2>
        <div class="log" id="event-log">
            <div class="entry"><span class="timestamp">[00:00:00]</span> Syst√®me initialis√©</div>
        </div>
    </div>

    <script>
        // Facteurs de conversion
        const conversions = {
            distance: {
                nm: { km: 1.852, mi: 1.15078, nm: 1 },
                km: { nm: 0.539957, mi: 0.621371, km: 1 },
                mi: { nm: 0.868976, km: 1.60934, mi: 1 }
            },
            altitude: {
                ft: { m: 0.3048, ft: 1, FL: (v) => v >= 18000 ? Math.floor(v/100) : v },
                m: { ft: 3.28084, m: 1, FL: (v) => v >= 5486 ? Math.floor(v/30.48) : v },
                FL: { ft: (v) => v * 100, m: (v) => v * 30.48, FL: (v) => v }
            },
            speed: {
                kt: { 'km/h': 1.852, mph: 1.15078, 'm/s': 0.514444, kt: 1 },
                'km/h': { kt: 0.539957, mph: 0.621371, 'm/s': 0.277778, 'km/h': 1 },
                mph: { kt: 0.868976, 'km/h': 1.60934, 'm/s': 0.44704, mph: 1 },
                'm/s': { kt: 1.94384, 'km/h': 3.6, mph: 2.23694, 'm/s': 1 }
            },
            temperature: {
                C: { F: (c) => c * 9/5 + 32, C: (c) => c },
                F: { C: (f) => (f - 32) * 5/9, F: (f) => f }
            },
            pressure: {
                hPa: { inHg: 0.02953, mb: 1, hPa: 1 },
                inHg: { hPa: 33.8639, mb: 33.8639, inHg: 1 },
                mb: { hPa: 1, inHg: 0.02953, mb: 1 }
            },
            fuel: {
                ltr: { gal: 0.264172, kg: 0.8, lbs: 1.76373, ltr: 1 },
                gal: { ltr: 3.78541, kg: 3.02833, lbs: 6.67, gal: 1 },
                kg: { ltr: 1.25, gal: 0.330215, lbs: 2.20462, kg: 1 },
                lbs: { ltr: 0.567, gal: 0.149875, kg: 0.453592, lbs: 1 }
            }
        };

        // Valeurs sources
        const sourceValues = {
            distance: 125,  // NM
            altitude: 4500, // ft
            speed: 108,     // kt
            temperature: 15, // ¬∞C
            pressure: 1013,  // hPa
            wind: 15,       // kt
            fuel: 120,      // L
            consumption: 35, // L/h
            fuelWeight: 96  // kg
        };

        function addLog(message) {
            const log = document.getElementById('event-log');
            const time = new Date().toLocaleTimeString('fr-FR');
            const entry = document.createElement('div');
            entry.className = 'entry';
            entry.innerHTML = `<span class="timestamp">[${time}]</span> ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        function convert(value, category, from, to) {
            if (from === to) return value;
            
            const converter = conversions[category][from][to];
            if (typeof converter === 'function') {
                return converter(value);
            } else if (typeof converter === 'number') {
                return value * converter;
            }
            return value;
        }

        function formatValue(value, unit) {
            const symbols = {
                nm: 'NM', km: 'km', mi: 'mi',
                ft: 'ft', m: 'm', FL: 'FL',
                kt: 'kt', 'km/h': 'km/h', mph: 'mph', 'm/s': 'm/s',
                C: '¬∞C', F: '¬∞F',
                hPa: 'hPa', inHg: 'inHg', mb: 'mb',
                ltr: 'L', gal: 'gal', kg: 'kg', lbs: 'lbs'
            };
            
            if (unit === 'FL' && typeof value === 'number') {
                return `FL${Math.floor(value).toString().padStart(3, '0')}`;
            }
            
            const decimals = ['distance', 'speed', 'fuel'].includes(getCategory(unit)) ? 1 : 0;
            return `${value.toFixed(decimals)} ${symbols[unit] || unit}`;
        }

        function getCategory(unit) {
            for (const [cat, units] of Object.entries(conversions)) {
                if (Object.keys(units).includes(unit)) return cat;
            }
            return null;
        }

        function applyUnits() {
            const units = {
                distance: document.getElementById('unit-distance').value,
                altitude: document.getElementById('unit-altitude').value,
                speed: document.getElementById('unit-speed').value,
                temperature: document.getElementById('unit-temperature').value,
                pressure: document.getElementById('unit-pressure').value,
                fuel: document.getElementById('unit-fuel').value
            };

            // Distance
            const distanceConverted = convert(sourceValues.distance, 'distance', 'nm', units.distance);
            document.getElementById('distance-value').textContent = formatValue(distanceConverted, units.distance);

            // Altitude
            const altitudeConverted = convert(sourceValues.altitude, 'altitude', 'ft', units.altitude);
            document.getElementById('altitude-value').textContent = formatValue(altitudeConverted, units.altitude);

            // Vitesse
            const speedConverted = convert(sourceValues.speed, 'speed', 'kt', units.speed);
            document.getElementById('speed-value').textContent = formatValue(speedConverted, units.speed);

            // Vent
            const windConverted = convert(sourceValues.wind, 'speed', 'kt', units.speed);
            document.getElementById('wind-value').textContent = formatValue(windConverted, units.speed);

            // Temp√©rature
            const tempConverted = convert(sourceValues.temperature, 'temperature', 'C', units.temperature);
            document.getElementById('temp-value').textContent = formatValue(tempConverted, units.temperature);

            // Pression
            const pressureConverted = convert(sourceValues.pressure, 'pressure', 'hPa', units.pressure);
            document.getElementById('pressure-value').textContent = formatValue(pressureConverted, units.pressure);

            // Carburant
            const fuelConverted = convert(sourceValues.fuel, 'fuel', 'ltr', units.fuel);
            document.getElementById('fuel-value').textContent = formatValue(fuelConverted, units.fuel);

            // Consommation
            const consumptionUnit = units.fuel === 'ltr' ? 'L/h' : units.fuel === 'gal' ? 'gal/h' : units.fuel + '/h';
            const consumptionConverted = convert(sourceValues.consumption, 'fuel', 'ltr', units.fuel);
            document.getElementById('consumption-value').textContent = formatValue(consumptionConverted, units.fuel).replace(units.fuel, consumptionUnit);

            // Poids carburant
            const fuelWeightUnit = units.fuel === 'kg' || units.fuel === 'lbs' ? units.fuel : 'kg';
            let fuelWeightConverted = sourceValues.fuelWeight;
            if (fuelWeightUnit === 'lbs') {
                fuelWeightConverted = convert(sourceValues.fuelWeight, 'fuel', 'kg', 'lbs');
            }
            document.getElementById('fuel-weight-value').textContent = formatValue(fuelWeightConverted, fuelWeightUnit);

            // Dispatch event
            window.dispatchEvent(new CustomEvent('unitsUpdated', { detail: units }));
            addLog(`Unit√©s appliqu√©es: ${JSON.stringify(units)}`);
        }

        function testEurope() {
            document.getElementById('unit-distance').value = 'nm';
            document.getElementById('unit-altitude').value = 'ft';
            document.getElementById('unit-speed').value = 'kt';
            document.getElementById('unit-temperature').value = 'C';
            document.getElementById('unit-pressure').value = 'hPa';
            document.getElementById('unit-fuel').value = 'ltr';
            applyUnits();
            addLog('Preset Europe appliqu√©');
        }

        function testUSA() {
            document.getElementById('unit-distance').value = 'nm';
            document.getElementById('unit-altitude').value = 'ft';
            document.getElementById('unit-speed').value = 'kt';
            document.getElementById('unit-temperature').value = 'C';
            document.getElementById('unit-pressure').value = 'inHg';
            document.getElementById('unit-fuel').value = 'gal';
            applyUnits();
            addLog('Preset USA appliqu√©');
        }

        function testMetric() {
            document.getElementById('unit-distance').value = 'km';
            document.getElementById('unit-altitude').value = 'm';
            document.getElementById('unit-speed').value = 'km/h';
            document.getElementById('unit-temperature').value = 'C';
            document.getElementById('unit-pressure').value = 'hPa';
            document.getElementById('unit-fuel').value = 'ltr';
            applyUnits();
            addLog('Preset M√©trique appliqu√©');
        }

        // Listen for units updates
        window.addEventListener('unitsUpdated', (event) => {
            console.log('Units updated:', event.detail);
        });

        // Initial load
        addLog('Page de test charg√©e');
    </script>
</body>
</html>