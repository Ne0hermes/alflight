// üîß Script de correction cgLimits F-HSTR
// √Ä copier/coller dans la console du navigateur (F12)

(async function fixFHSTRCgLimits() {
  console.log('üîß [FIX] D√©marrage de la correction cgLimits pour F-HSTR...');

  // Importer Supabase depuis le CDN
  const { createClient } = window.supabase;

  if (!createClient) {
    console.error('‚ùå Supabase non disponible. Ouvrez cette page: http://localhost:4001/fix-cglimits-supabase.html');
    return;
  }

  const SUPABASE_URL = 'https://yawivlfiebsemtsxgmqz.supabase.co';
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inlhd2l2bGZpZWJzZW10c3hnbXF6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjgxNTE5NjcsImV4cCI6MjA0MzcyNzk2N30.QX5c9P7WUTQg5rHTTMp0D57HWmRxQXlNqHIGksMO-hY';

  const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  // √âtape 1 : V√©rifier l'√©tat actuel
  console.log('üîç V√©rification de l\'√©tat actuel de F-HSTR...');
  const { data: current, error: checkError } = await supabase
    .from('aircraft')
    .select('registration, model, cgLimits')
    .eq('registration', 'F-HSTR')
    .single();

  if (checkError) {
    console.error('‚ùå Erreur lors de la v√©rification:', checkError);
    return;
  }

  console.log(`‚úÖ Avion trouv√©: ${current.registration} (${current.model})`);

  if (current.cgLimits) {
    console.log(`‚úÖ cgLimits d√©j√† pr√©sents:`, current.cgLimits);
    console.log('‚ÑπÔ∏è  Aucune correction n√©cessaire');
    return;
  }

  console.log('‚ùå cgLimits MANQUANTS - Correction en cours...');

  // √âtape 2 : Corriger les cgLimits
  const cgLimits = {
    forward: 2.05,  // DA40 NG typical forward CG limit (m)
    aft: 2.31       // DA40 NG typical aft CG limit (m)
  };

  const { data, error } = await supabase
    .from('aircraft')
    .update({ cgLimits })
    .eq('registration', 'F-HSTR')
    .select();

  if (error) {
    console.error('‚ùå Erreur lors de la mise √† jour:', error);
    return;
  }

  console.log(`‚úÖ cgLimits ajout√©s avec succ√®s:`, cgLimits);
  console.log('‚úÖ F-HSTR mis √† jour dans Supabase');

  // √âtape 3 : Vider IndexedDB
  console.log('üóëÔ∏è  Suppression de IndexedDB...');
  const deleteRequest = indexedDB.deleteDatabase('alflight-aircraft-db');

  deleteRequest.onsuccess = function() {
    console.log('‚úÖ IndexedDB supprim√©e avec succ√®s');
    console.log('üîÑ Rechargez la page pour voir les modifications');
  };

  deleteRequest.onerror = function() {
    console.error('‚ùå Erreur lors de la suppression de IndexedDB');
    console.log('‚ÑπÔ∏è  Ex√©cutez manuellement: indexedDB.deleteDatabase("alflight-aircraft-db")');
  };
})();
