<!DOCTYPE html>
<html>
<head>
    <title>Test Champs √âditables</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        h1 { 
            color: #333; 
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .runway-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        .runway-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
        }
        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 10px 0;
        }
        .grid-4 {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 10px 0;
        }
        .field-group {
            display: flex;
            flex-direction: column;
        }
        label {
            font-size: 11px;
            color: #6b7280;
            margin-bottom: 2px;
            font-weight: 600;
        }
        input, select {
            padding: 6px 8px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 13px;
        }
        input.missing, select.missing {
            background-color: #fee2e2;
            border-color: #ef4444;
        }
        .ils-group {
            display: flex;
            gap: 4px;
        }
        .ils-group select {
            flex: 0 0 80px;
        }
        .ils-group input:nth-child(2) {
            flex: 1;
        }
        .ils-group input:nth-child(3) {
            flex: 0 0 50px;
        }
        .info-row {
            background: #e8f5e9;
            padding: 8px;
            border-radius: 4px;
            margin-top: 10px;
            font-size: 12px;
        }
        .vfr-section {
            background: #f3e8ff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .vfr-point {
            background: white;
            padding: 8px;
            margin: 5px 0;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõ¨ Test Interface √âditable - LFST Strasbourg</h1>
        <div id="output">‚è≥ Chargement des donn√©es...</div>
    </div>
    
    <script type="module">
        import { aixmParser } from '/src/services/aixmParser.js';
        
        async function displayEditableData() {
            const output = document.getElementById('output');
            
            try {
                const data = await aixmParser.loadAndParse();
                const lfst = data.find(ad => ad.icao === 'LFST');
                
                if (!lfst) {
                    output.innerHTML = '<div class="error">‚ùå LFST non trouv√©!</div>';
                    return;
                }
                
                let html = '<div class="success">‚úÖ Donn√©es LFST charg√©es avec succ√®s!</div>';
                
                // Info g√©n√©rale
                html += '<h2>üìç ' + lfst.name + ' (' + lfst.city + ')</h2>';
                html += '<p>Altitude: ' + lfst.elevation.value + ' ft ‚Ä¢ Variation magn√©tique: ' + (lfst.magneticVariation?.value || '?') + '¬∞</p>';
                
                // Pistes
                html += '<h2>üõ¨ Pistes - Champs √âditables</h2>';
                
                if (lfst.runways && lfst.runways.length > 0) {
                    for (const runway of lfst.runways) {
                        html += '<div class="runway-card">';
                        html += '<div class="runway-header">';
                        html += '<h3 style="margin: 0;">Piste ' + runway.designation + '</h3>';
                        html += '<div>Dimensions: ' + runway.length + ' √ó ' + runway.width + ' m</div>';
                        html += '</div>';
                        
                        // Distances d√©clar√©es
                        html += '<label>Distances d√©clar√©es (m)</label>';
                        html += '<div class="grid-4">';
                        html += '<div class="field-group">';
                        html += '<label>TORA</label>';
                        html += '<input type="number" value="' + (runway.tora || '') + '" placeholder="?" class="' + (runway.tora ? '' : 'missing') + '">';
                        html += '</div>';
                        html += '<div class="field-group">';
                        html += '<label>TODA</label>';
                        html += '<input type="number" value="' + (runway.toda || '') + '" placeholder="?" class="' + (runway.toda ? '' : 'missing') + '">';
                        html += '</div>';
                        html += '<div class="field-group">';
                        html += '<label>ASDA</label>';
                        html += '<input type="number" value="' + (runway.asda || '') + '" placeholder="?" class="' + (runway.asda ? '' : 'missing') + '">';
                        html += '</div>';
                        html += '<div class="field-group">';
                        html += '<label>LDA</label>';
                        html += '<input type="number" value="' + (runway.lda || '') + '" placeholder="?" class="' + (runway.lda ? '' : 'missing') + '">';
                        html += '</div>';
                        html += '</div>';
                        
                        // Surface, QFU, ILS
                        html += '<div class="grid-3">';
                        
                        html += '<div class="field-group">';
                        html += '<label>Surface</label>';
                        html += '<input type="text" value="' + (runway.surface || '') + '" placeholder="ASPH" class="' + (runway.surface ? '' : 'missing') + '">';
                        html += '</div>';
                        
                        html += '<div class="field-group">';
                        html += '<label>QFU (¬∞)</label>';
                        html += '<input type="number" step="0.1" value="' + (runway.qfu || runway.magneticBearing || '') + '" placeholder="?" class="' + ((runway.qfu || runway.magneticBearing) ? '' : 'missing') + '">';
                        html += '</div>';
                        
                        html += '<div class="field-group">';
                        html += '<label>ILS</label>';
                        html += '<div class="ils-group">';
                        html += '<select class="' + (runway.ils ? '' : 'missing') + '">';
                        html += '<option value="">-</option>';
                        html += '<option value="I"' + (runway.ils?.category === 'I' ? ' selected' : '') + '>CAT I</option>';
                        html += '<option value="II"' + (runway.ils?.category === 'II' ? ' selected' : '') + '>CAT II</option>';
                        html += '<option value="III"' + (runway.ils?.category === 'III' ? ' selected' : '') + '>CAT III</option>';
                        html += '<option value="IIIA"' + (runway.ils?.category === 'IIIA' ? ' selected' : '') + '>CAT IIIA</option>';
                        html += '<option value="IIIB"' + (runway.ils?.category === 'IIIB' ? ' selected' : '') + '>CAT IIIB</option>';
                        html += '<option value="IIIC"' + (runway.ils?.category === 'IIIC' ? ' selected' : '') + '>CAT IIIC</option>';
                        html += '</select>';
                        html += '<input type="number" step="0.01" value="' + (runway.ils?.frequency || '') + '" placeholder="MHz" title="Fr√©quence ILS">';
                        html += '<input type="text" maxlength="3" value="' + (runway.ils?.identifier || '') + '" placeholder="ID" title="Indicatif ILS">';
                        html += '</div>';
                        html += '</div>';
                        
                        html += '</div>';
                        
                        // Affichage format√© des donn√©es actuelles
                        if (runway.ils) {
                            html += '<div class="info-row">';
                            html += 'üì° ILS actuels: ';
                            html += 'CAT ' + runway.ils.category;
                            html += ' ‚Ä¢ Freq: ' + runway.ils.frequency + ' MHz';
                            html += ' ‚Ä¢ ID: ' + runway.ils.identifier;
                            if (runway.ils.glidePath) {
                                html += ' ‚Ä¢ Glide: ' + runway.ils.glidePath.slope + '¬∞';
                            }
                            html += '</div>';
                        }
                        
                        html += '</div>';
                    }
                } else {
                    html += '<div class="error">Aucune piste trouv√©e</div>';
                }
                
                // Points VFR
                if (lfst.vfrPoints && lfst.vfrPoints.length > 0) {
                    html += '<div class="vfr-section">';
                    html += '<h2>üìç Points VFR (' + lfst.vfrPoints.length + ' points)</h2>';
                    
                    // Afficher les 5 premiers points
                    for (let i = 0; i < Math.min(5, lfst.vfrPoints.length); i++) {
                        const point = lfst.vfrPoints[i];
                        html += '<div class="vfr-point">';
                        html += '<div>';
                        html += '<strong>' + point.name + '</strong> (' + point.id + ')<br>';
                        html += '<small>' + point.description + '</small>';
                        html += '</div>';
                        html += '<div style="text-align: right; font-size: 11px; color: #6b7280;">';
                        html += point.coordinates.lat.toFixed(4) + '¬∞N<br>';
                        html += point.coordinates.lon.toFixed(4) + '¬∞E';
                        html += '</div>';
                        html += '</div>';
                    }
                    
                    if (lfst.vfrPoints.length > 5) {
                        html += '<div style="text-align: center; padding: 10px; color: #6b7280;">... et ' + (lfst.vfrPoints.length - 5) + ' autres points</div>';
                    }
                    
                    html += '</div>';
                }
                
                output.innerHTML = html;
                
                // Log pour debug
                console.log('LFST complet:', lfst);
                console.log('Pistes:', lfst.runways);
                if (lfst.runways && lfst.runways[0]) {
                    console.log('ILS piste 05:', lfst.runways[0].ils);
                }
                if (lfst.runways && lfst.runways[1]) {
                    console.log('ILS piste 23:', lfst.runways[1].ils);
                }
                
            } catch (error) {
                output.innerHTML = '<div class="error">‚ùå Erreur: ' + error.message + '</div>';
                console.error('Erreur:', error);
            }
        }
        
        displayEditableData();
    </script>
</body>
</html>