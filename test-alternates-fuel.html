<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Calcul Carburant Alternates</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .result {
            padding: 10px;
            margin: 10px 0;
            background: #f0f0f0;
            border-radius: 3px;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 3px;
        }
        button:hover {
            background: #0056b3;
        }
        pre {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üõ¢Ô∏è Test du Calcul de Carburant pour D√©routements</h1>
    
    <div class="test-section">
        <h2>1. V√©rifier les Stores</h2>
        <button onclick="checkStores()">V√©rifier les Stores</button>
        <div id="stores-result"></div>
    </div>

    <div class="test-section">
        <h2>2. Simuler une S√©lection d'Alternate</h2>
        <button onclick="simulateAlternateSelection()">Simuler S√©lection</button>
        <div id="simulate-result"></div>
    </div>

    <div class="test-section">
        <h2>3. Tester le Calcul de Distance</h2>
        <button onclick="testDistanceCalculation()">Tester Distance</button>
        <div id="distance-result"></div>
    </div>

    <div class="test-section">
        <h2>4. V√©rifier le Hook useAlternatesForFuel</h2>
        <button onclick="testFuelHook()">Tester Hook Fuel</button>
        <div id="hook-result"></div>
    </div>

    <script>
        function checkStores() {
            const result = document.getElementById('stores-result');
            try {
                // Acc√©der aux stores via la console
                const script = `
                    const alternatesStore = window.useAlternatesStore?.getState();
                    const aircraftData = localStorage.getItem('selectedAircraft');
                    const waypoints = localStorage.getItem('waypoints');
                    
                    return {
                        alternates: alternatesStore?.selectedAlternates || [],
                        alternatesCount: alternatesStore?.selectedAlternates?.length || 0,
                        aircraft: aircraftData ? JSON.parse(aircraftData) : null,
                        waypoints: waypoints ? JSON.parse(waypoints) : []
                    };
                `;
                
                // Note: Pour ex√©cuter ce test, ouvrez la console et copiez le code
                result.innerHTML = `
                    <div class="result">
                        <strong>Instructions:</strong><br>
                        1. Ouvrez la console du navigateur (F12)<br>
                        2. Copiez et ex√©cutez ce code:<br>
                        <pre>${script}</pre>
                        3. V√©rifiez les r√©sultats dans la console
                    </div>
                `;
            } catch (error) {
                result.innerHTML = `<div class="result error">Erreur: ${error.message}</div>`;
            }
        }

        function simulateAlternateSelection() {
            const result = document.getElementById('simulate-result');
            
            const testAlternate = {
                icao: 'LFPG',
                name: 'Paris CDG',
                position: { lat: 49.0097, lon: 2.5479 },
                selectionType: 'departure',
                runways: [{ length: 4200, width: 60, surface: 'asphalt' }]
            };
            
            const script = `
                // Simuler une s√©lection d'alternate
                const testAlternate = ${JSON.stringify(testAlternate, null, 2)};
                
                // Ajouter au store
                window.useAlternatesStore?.getState().setSelectedAlternates([testAlternate]);
                
                // V√©rifier
                const selected = window.useAlternatesStore?.getState().selectedAlternates;
                console.log('Alternates s√©lectionn√©s:', selected);
                
                return selected;
            `;
            
            result.innerHTML = `
                <div class="result">
                    <strong>Test d'ajout d'alternate:</strong><br>
                    <pre>${script}</pre>
                    Ex√©cutez ce code dans la console pour tester.
                </div>
            `;
        }

        function testDistanceCalculation() {
            const result = document.getElementById('distance-result');
            
            // Fonction de calcul de distance
            const calculateDistance = (point1, point2) => {
                const R = 3440.065; // Rayon terre en NM
                const dLat = (point2.lat - point1.lat) * Math.PI / 180;
                const dLon = (point2.lon - point1.lon) * Math.PI / 180;
                
                const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.cos(point1.lat * Math.PI / 180) * Math.cos(point2.lat * Math.PI / 180) *
                    Math.sin(dLon/2) * Math.sin(dLon/2);
                    
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
                return R * c;
            };
            
            // Test avec des coordonn√©es connues
            const paris = { lat: 48.8566, lon: 2.3522 };
            const lyon = { lat: 45.7640, lon: 4.8357 };
            
            const distance = calculateDistance(paris, lyon);
            
            result.innerHTML = `
                <div class="result success">
                    <strong>Test de calcul de distance:</strong><br>
                    Paris (48.8566, 2.3522) ‚Üí Lyon (45.7640, 4.8357)<br>
                    Distance calcul√©e: <strong>${distance.toFixed(1)} NM</strong><br>
                    (Distance r√©elle: ~215 NM)
                </div>
            `;
        }

        function testFuelHook() {
            const result = document.getElementById('hook-result');
            
            const script = `
                // V√©rifier le hook useAlternatesForFuel
                // Ce code doit √™tre ex√©cut√© dans le contexte React de l'application
                
                // 1. V√©rifier les alternates s√©lectionn√©s
                const alternates = window.useAlternatesStore?.getState().selectedAlternates;
                console.log('Alternates:', alternates);
                
                // 2. V√©rifier l'avion
                const aircraft = JSON.parse(localStorage.getItem('selectedAircraft') || '{}');
                console.log('Aircraft:', aircraft);
                console.log('Fuel consumption:', aircraft.fuelConsumption);
                console.log('Cruise speed:', aircraft.cruiseSpeedKt || aircraft.cruiseSpeed);
                
                // 3. V√©rifier les waypoints
                const waypoints = JSON.parse(localStorage.getItem('waypoints') || '[]');
                console.log('Waypoints:', waypoints.length);
                
                // 4. Calculer manuellement
                if (alternates?.length > 0 && aircraft && waypoints?.length >= 2) {
                    const maxDistance = 50; // Exemple: 50 NM
                    const cruiseSpeed = aircraft.cruiseSpeedKt || aircraft.cruiseSpeed || 100;
                    const fuelConsumption = aircraft.fuelConsumption || 30;
                    const flightTime = maxDistance / cruiseSpeed;
                    const totalTime = flightTime + 0.5; // +30 min
                    const fuelRequired = totalTime * fuelConsumption;
                    
                    console.log('Calcul manuel:');
                    console.log('- Distance max:', maxDistance, 'NM');
                    console.log('- Vitesse:', cruiseSpeed, 'kt');
                    console.log('- Temps vol:', flightTime, 'h');
                    console.log('- Temps total:', totalTime, 'h');
                    console.log('- Consommation:', fuelConsumption, 'L/h');
                    console.log('- Carburant requis:', fuelRequired, 'L');
                }
            `;
            
            result.innerHTML = `
                <div class="result">
                    <strong>Test du hook useAlternatesForFuel:</strong><br>
                    <pre>${script}</pre>
                    Copiez ce code dans la console pour diagnostiquer.
                </div>
            `;
        }
    </script>

    <div class="test-section">
        <h2>üìã Checklist de D√©bogage</h2>
        <ul>
            <li>‚úÖ Ouvrir la console du navigateur (F12)</li>
            <li>‚úÖ V√©rifier les logs commen√ßant par üõ¢Ô∏è</li>
            <li>‚úÖ V√©rifier les logs commen√ßant par üìä</li>
            <li>‚úÖ V√©rifier les logs commen√ßant par üî•</li>
            <li>‚úÖ S'assurer qu'un avion est s√©lectionn√© avec consommation d√©finie</li>
            <li>‚úÖ S'assurer qu'une route est d√©finie (d√©part + arriv√©e)</li>
            <li>‚úÖ S'assurer qu'au moins un alternate est s√©lectionn√©</li>
            <li>‚úÖ V√©rifier que l'alternate a une position valide</li>
            <li>‚úÖ V√©rifier que l'alternate a un selectionType ('departure' ou 'arrival')</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>üîç Commandes Console Utiles</h2>
        <pre>
// Voir les alternates s√©lectionn√©s
useAlternatesStore.getState().selectedAlternates

// Voir l'avion s√©lectionn√©
JSON.parse(localStorage.getItem('selectedAircraft'))

// Voir les waypoints
JSON.parse(localStorage.getItem('waypoints'))

// Forcer un recalcul
useAlternatesStore.getState().setSelectedAlternates(useAlternatesStore.getState().selectedAlternates)
        </pre>
    </div>
</body>
</html>