<!DOCTYPE html>
<html>
<head>
  <title>Fix cgLimits F-HSTR</title>
  <style>
    body { font-family: monospace; padding: 20px; background: #1e1e1e; color: #d4d4d4; }
    button { background: #0e639c; color: white; border: none; padding: 15px 30px; font-size: 18px; cursor: pointer; border-radius: 4px; margin: 20px 0; }
    button:hover { background: #1177bb; }
    pre { background: #252526; padding: 15px; border-radius: 4px; }
    .warning { background: #433715; border-left: 4px solid #f59e0b; padding: 15px; margin: 15px 0; }
    .success { background: #1e3a1e; border-left: 4px solid #10b981; padding: 15px; margin: 15px 0; }
  </style>
</head>
<body>
  <h1>ğŸ”§ Correction cgLimits F-HSTR</h1>

  <div class="warning">
    <strong>âš ï¸ VALEURS ACTUELLES FAUSSES:</strong><br>
    forward: 2.05 â†’ devrait Ãªtre 2.40 (35cm d'erreur!)<br>
    aft: 2.31 â†’ devrait Ãªtre 2.59 (28cm d'erreur!)
  </div>

  <button onclick="fix()">âœ… CORRIGER MAINTENANT</button>

  <pre id="log">PrÃªt Ã  corriger...</pre>

  <script>
async function fix() {
  const log = document.getElementById('log');
  log.textContent = 'â³ Correction en cours...\n';

  try {
    const response = await fetch('https://yawivlfiebsemtsxgmqz.supabase.co/rest/v1/aircraft?registration=eq.F-HSTR', {
      method: 'PATCH',
      headers: {
        'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inlhd2l2bGZpZWJzZW10c3hnbXF6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjgxNTE5NjcsImV4cCI6MjA0MzcyNzk2N30.QX5c9P7WUTQg5rHTTMp0D57HWmRxQXlNqHIGksMO-hY',
        'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inlhd2l2bGZpZWJzZW10c3hnbXF6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjgxNTE5NjcsImV4cCI6MjA0MzcyNzk2N30.QX5c9P7WUTQg5rHTTMp0D57HWmRxQXlNqHIGksMO-hY',
        'Content-Type': 'application/json',
        'Prefer': 'return=representation'
      },
      body: JSON.stringify({
        cgEnvelope: {
          forwardPoints: [
            { mass: 780, cg: 2.40 },
            { mass: 980, cg: 2.40 },
            { mass: 1150, cg: 2.46 }
          ],
          aftCG: 2.59
        },
        cgLimits: {
          forward: 2.40,
          aft: 2.59
        }
      })
    });

    const data = await response.json();
    log.textContent = 'âœ… Supabase mis Ã  jour!\n\n' + JSON.stringify(data, null, 2);

    log.textContent += '\n\nğŸ—‘ï¸ Suppression IndexedDB...';

    indexedDB.deleteDatabase('alflight-aircraft-db').onsuccess = () => {
      log.textContent += '\nâœ… IndexedDB vidÃ©e!';
      alert('âœ… SUCCÃˆS!\n\nLimites AVANT: 2.05 â†’ 2.40 âœ…\nLimites ARRIÃˆRE: 2.31 â†’ 2.59 âœ…\n\nFermez cette page et rechargez votre app (Ctrl+R)');
    };

  } catch (error) {
    log.textContent = 'âŒ Erreur: ' + error.message;
  }
}
  </script>
</body>
</html>
